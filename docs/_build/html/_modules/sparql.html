
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>sparql &#8212; Meta-Data Browser for Live Music  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sparql</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">SPARQLWrapper</span> <span class="k">import</span> <span class="n">SPARQLWrapper</span><span class="p">,</span> <span class="n">JSON</span><span class="p">,</span> <span class="n">POSTDIRECTLY</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">urllib</span>

<div class="viewcode-block" id="SPARQL"><a class="viewcode-back" href="../test_build/sparql.html#sparql.SPARQL">[docs]</a><span class="k">class</span> <span class="nc">SPARQL</span><span class="p">():</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes an instance of the SPARQL class.</span>

<span class="sd">    The SPARQL class is used for all interfacing with the SPARQL end-point provided by Sean Bechhofer&#39;s research and work.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span> <span class="o">=</span> <span class="n">SPARQLWrapper</span><span class="p">(</span><span class="s2">&quot;http://etree.linkedmusic.org/sparql&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">setReturnFormat</span><span class="p">(</span><span class="n">JSON</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">setMethod</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="SPARQL.get_release_properties"><a class="viewcode-back" href="../test_build/sparql.html#sparql.SPARQL.get_release_properties">[docs]</a>  <span class="k">def</span> <span class="nf">get_release_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">releaseName</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the properties of a given release.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    releaseName : string</span>
<span class="sd">        Name of the release.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    properties : dict</span>
<span class="sd">        The properties found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">queryGetURI</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                      SELECT * {{</span>
<span class="s2">                        ?s ?p &quot;</span><span class="si">{0}</span><span class="s2">&quot;.</span>
<span class="s2">                      }}</span>
<span class="s2">                      &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">releaseName</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">setQuery</span><span class="p">(</span><span class="n">queryGetURI</span><span class="p">)</span>
      <span class="n">queryResults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>

      <span class="n">queryGetProperties</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                              SELECT * {{</span>
<span class="s2">                                &lt;</span><span class="si">{0}</span><span class="s2">&gt; ?p ?o.</span>
<span class="s2">                              }}</span>
<span class="s2">                           &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">queryResults</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;s&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">setQuery</span><span class="p">(</span><span class="n">queryGetProperties</span><span class="p">)</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">e</span></div>

<div class="viewcode-block" id="SPARQL.get_release_subproperties"><a class="viewcode-back" href="../test_build/sparql.html#sparql.SPARQL.get_release_subproperties">[docs]</a>  <span class="k">def</span> <span class="nf">get_release_subproperties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the sub-properties of a given release.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    subject : string</span>
<span class="sd">        The release for which we want to retrieve the sub-properties of.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    results : dictionary</span>
<span class="sd">        A JSON dictionary of the properties returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">queryGetProperties</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                            SELECT * {{</span>
<span class="s2">                              &lt;</span><span class="si">{0}</span><span class="s2">&gt; ?p ?o.</span>
<span class="s2">                            }}</span>
<span class="s2">                         &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">subject</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">setQuery</span><span class="p">(</span><span class="n">queryGetProperties</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
      <span class="k">pass</span></div>

<div class="viewcode-block" id="SPARQL.get_tracklist"><a class="viewcode-back" href="../test_build/sparql.html#sparql.SPARQL.get_tracklist">[docs]</a>  <span class="k">def</span> <span class="nf">get_tracklist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves a track-list for a given recording.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    label : string</span>
<span class="sd">        The label of the released used to identify the tracks which belong to it.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    results : dict</span>
<span class="sd">        A JSON representation of the results returned by the end-point.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">queryString</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            PREFIX etree:&lt;http://etree.linkedmusic.org/vocab/&gt;</span>
<span class="s2">            PREFIX mo:&lt;http://purl.org/ontology/mo/&gt;</span>
<span class="s2">            PREFIX event:&lt;http://purl.org/NET/c4dm/event.owl#&gt;</span>
<span class="s2">            PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;</span>
<span class="s2">            PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>

<span class="s2">              SELECT DISTINCT ?audio ?label ?num ?tracklist {{</span>
<span class="s2">                ?perf event:hasSubEvent ?tracklist.</span>
<span class="s2">                ?tracklist skos:prefLabel ?label.</span>
<span class="s2">                ?tracklist etree:number ?num.</span>
<span class="s2">                ?tracklist etree:audio ?audio.</span>
<span class="s2">                ?perf rdf:type mo:Performance.</span>
<span class="s2">                ?perf skos:prefLabel &quot;</span><span class="si">{0}</span><span class="s2">&quot;.</span>
<span class="s2">            }} GROUP BY ?label ?audio ?num ORDER BY ?num </span>
<span class="s2">          &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">setQuery</span><span class="p">(</span><span class="n">queryString</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span></div>

<div class="viewcode-block" id="SPARQL.get_tracklist_grouped"><a class="viewcode-back" href="../test_build/sparql.html#sparql.SPARQL.get_tracklist_grouped">[docs]</a>  <span class="k">def</span> <span class="nf">get_tracklist_grouped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>

    <span class="n">queryString</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            PREFIX etree:&lt;http://etree.linkedmusic.org/vocab/&gt;</span>
<span class="s2">            PREFIX mo:&lt;http://purl.org/ontology/mo/&gt;</span>
<span class="s2">            PREFIX event:&lt;http://purl.org/NET/c4dm/event.owl#&gt;</span>
<span class="s2">            PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;</span>
<span class="s2">            PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>
<span class="s2">            PREFIX calma: &lt;http://calma.linkedmusic.org/vocab/&gt;</span>

<span class="s2">            SELECT DISTINCT (group_concat(distinct ?audio; separator = &quot;</span><span class="se">\\</span><span class="s2">n&quot;) AS ?audio) (group_concat(distinct ?calma; separator = &quot;</span><span class="se">\\</span><span class="s2">n&quot;) AS </span>
<span class="s2">            ?calma) ?label ?num ?tracklist {{</span>
<span class="s2">              ?perf event:hasSubEvent ?tracklist.</span>
<span class="s2">              ?tracklist skos:prefLabel ?label.</span>
<span class="s2">              ?tracklist etree:number ?num.</span>
<span class="s2">              ?tracklist etree:audio ?audio.</span>
<span class="s2">              ?perf rdf:type mo:Performance.</span>
<span class="s2">              ?perf skos:prefLabel &quot;</span><span class="si">{0}</span><span class="s2">&quot;.</span>
<span class="s2">              OPTIONAL {{?tracklist calma:data ?calma}}.</span>
<span class="s2">            }} ORDER BY ?num </span>
<span class="s2">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">queryString</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">setQuery</span><span class="p">(</span><span class="n">queryString</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span></div>

<div class="viewcode-block" id="SPARQL.get_artist_releases"><a class="viewcode-back" href="../test_build/sparql.html#sparql.SPARQL.get_artist_releases">[docs]</a>  <span class="k">def</span> <span class="nf">get_artist_releases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filterField</span><span class="p">,</span> <span class="n">filterStr</span><span class="p">,</span> <span class="n">sparqlField</span><span class="p">,</span> <span class="n">sparqlTriple</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves all the releases by a particular artist.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filterField : string</span>
<span class="sd">        The filter field.</span>

<span class="sd">    filterStr : string</span>
<span class="sd">        The filter string.</span>

<span class="sd">    sparqlField : string</span>
<span class="sd">        If a custom field is required (e.g genre), this is the field value required.</span>

<span class="sd">    sparqlTriple : string</span>
<span class="sd">        If a custom field is required (e.g genre), this is the triple required.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    results : dictionary</span>
<span class="sd">        A JSON representation of the results returned by the end-point.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">sparql</span> <span class="o">=</span> <span class="n">SPARQLWrapper</span><span class="p">(</span><span class="s2">&quot;http://etree.linkedmusic.org/sparql&quot;</span><span class="p">)</span>
    <span class="n">sparql</span><span class="o">.</span><span class="n">setReturnFormat</span><span class="p">(</span><span class="n">JSON</span><span class="p">)</span>
    <span class="n">queryString</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">          PREFIX etree:&lt;http://etree.linkedmusic.org/vocab/&gt;</span>
<span class="s2">          PREFIX mo:&lt;http://purl.org/ontology/mo/&gt;</span>
<span class="s2">          PREFIX event:&lt;http://purl.org/NET/c4dm/event.owl#&gt;</span>
<span class="s2">          PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;</span>
<span class="s2">          PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>

<span class="s2">          SELECT DISTINCT ?performer ?name ?prefLabel ?place ?date </span><span class="si">{0}</span><span class="s2">  WHERE </span>
<span class="s2">          {{      </span>
<span class="s2">                ?art skos:prefLabel ?prefLabel.  </span>
<span class="s2">                ?art event:place ?location.</span>
<span class="s2">                ?location etree:location ?place.</span>
<span class="s2">                ?performer foaf:name ?name.</span>
<span class="s2">                ?art etree:date ?date.</span>
<span class="s2">                ?art mo:performer ?performer.</span>
<span class="s2">                </span><span class="si">{1}</span><span class="s2"></span>
<span class="s2">          &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sparqlField</span><span class="p">,</span> <span class="n">sparqlTriple</span><span class="p">)</span>

    <span class="c1"># If we have multiple filters (hence type LIST)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filterStr</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
      <span class="c1"># Add prefix</span>
      <span class="n">queryString</span> <span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">FILTER(&#39;</span>

      <span class="c1"># Add each filter statement</span>
      <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">filterStr</span><span class="p">:</span>
        <span class="n">queryString</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;?</span><span class="si">{0}</span><span class="s2">=&quot;</span><span class="si">{1}</span><span class="s2">&quot; ||</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filterField</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

      <span class="c1"># Add suffix to be syntactically correct</span>
      <span class="n">queryString</span> <span class="o">=</span> <span class="n">queryString</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
      <span class="n">queryString</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>

    <span class="c1"># If we have a singlular filter (hence type STRING)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filterField</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">queryString</span> <span class="o">+=</span>  <span class="s2">&quot;&quot;&quot;FILTER(?</span><span class="si">{0}</span><span class="s2">=&quot;</span><span class="si">{1}</span><span class="s2">&quot;)&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filterField</span><span class="p">,</span> <span class="n">filterStr</span><span class="p">)</span>

    <span class="c1"># Add ending line of query</span>
    <span class="n">queryString</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">}  GROUP BY (?name)&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">queryString</span><span class="p">)</span>
    <span class="c1"># Set and run query</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">setQuery</span><span class="p">(</span><span class="n">queryString</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span></div>

<div class="viewcode-block" id="SPARQL.execute_string"><a class="viewcode-back" href="../test_build/sparql.html#sparql.SPARQL.execute_string">[docs]</a>  <span class="k">def</span> <span class="nf">execute_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryString</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes a string representing a SPARQL query.</span>

<span class="sd">    Having a general purpose &quot;execute whatever this query is&quot; is quite useful.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    queryString : string</span>
<span class="sd">        The SPARQL query string to be executed.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    results : dictionary</span>
<span class="sd">        A JSON representation of the results returned by the end-point.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">setReturnFormat</span><span class="p">(</span><span class="n">JSON</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">setQuery</span><span class="p">(</span><span class="n">queryString</span><span class="p">)</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">e</span></div>

<div class="viewcode-block" id="SPARQL.date_range"><a class="viewcode-back" href="../test_build/sparql.html#sparql.SPARQL.date_range">[docs]</a>  <span class="k">def</span> <span class="nf">date_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a filter for a given range of dates.</span>

<span class="sd">    SPARQL supports filtering, and this may be used to provide more specific results for a given date range.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    start : string</span>
<span class="sd">        The start date.</span>

<span class="sd">    end : string</span>
<span class="sd">        The end date.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dateRange : string</span>
<span class="sd">        A structured string that is inserted into the query to provide date filtering.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Normalize dates</span>
    <span class="n">startDate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="n">endDate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">endDate</span> <span class="o">-</span> <span class="n">startDate</span>

    <span class="c1"># If there are days to be filtered</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">days</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">delta</span><span class="o">.</span><span class="n">days</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">):</span>
      <span class="n">dateRange</span> <span class="o">=</span> <span class="s1">&#39;FILTER (&#39;</span>

      <span class="c1"># Calculate date difference between start + end</span>
      <span class="n">delta</span> <span class="o">=</span> <span class="n">endDate</span> <span class="o">-</span> <span class="n">startDate</span>

      <span class="c1"># If there are days to be filtered</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">days</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="c1"># Generate filter string</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
          <span class="n">dateRange</span> <span class="o">=</span> <span class="n">dateRange</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot; str(?date) = &#39;&quot;&quot;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">startDate</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;&#39; </span><span class="se">\n</span><span class="s2">                ||&quot;&quot;&quot;</span>

        <span class="c1"># Add suffix</span>
        <span class="n">dateRange</span> <span class="o">=</span> <span class="n">dateRange</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">dateRange</span> <span class="o">=</span> <span class="n">dateRange</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>

        <span class="k">return</span> <span class="n">dateRange</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="s1">&#39;&#39;</span></div>

<div class="viewcode-block" id="SPARQL.perform_search"><a class="viewcode-back" href="../test_build/sparql.html#sparql.SPARQL.perform_search">[docs]</a>  <span class="k">def</span> <span class="nf">perform_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dateFrom</span><span class="p">,</span> <span class="n">dateTo</span><span class="p">,</span> <span class="n">artists</span><span class="p">,</span> <span class="n">genres</span><span class="p">,</span> <span class="n">locations</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">trackName</span><span class="p">,</span> <span class="n">countries</span><span class="p">,</span> <span class="n">customSearchString</span><span class="p">,</span> <span class="n">venue</span><span class="p">,</span> <span class="n">orderBy</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes a basic search on the SPARQL end-point.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dateFrom : string</span>
<span class="sd">        Start date for our date range filter.</span>

<span class="sd">    dateTo : string</span>
<span class="sd">        End date for our date range filter.</span>

<span class="sd">    artists : string</span>
<span class="sd">        A list of artists, comma seperated.</span>

<span class="sd">    genres : string</span>
<span class="sd">        A list of genres, comma seperated.</span>

<span class="sd">    locations : string</span>
<span class="sd">        A list of locations, comma seperated.</span>

<span class="sd">    lineage : string</span>
<span class="sd">        A list of lineage steps, comma seperated.</span>

<span class="sd">    limit : int</span>
<span class="sd">        Number of results to be returned.</span>

<span class="sd">    distinct : boolean</span>
<span class="sd">        Represents whether or not results should be distinct (i.e. no duplicates).</span>

<span class="sd">    fields : string</span>
<span class="sd">      A list of fields, comma seperated.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    q : string</span>
<span class="sd">        A string which may be executed as a SPARQL query.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">artists</span> <span class="o">=</span> <span class="n">artists</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">genres</span> <span class="o">=</span> <span class="n">genres</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

    <span class="n">artists</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">]</span>
    <span class="n">genres</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">genres</span><span class="p">]</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="s2">&quot; ?label ?performer ?description ?location ?place ?date ?genre&quot;</span>
    <span class="n">whereString</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">     ?art skos:prefLabel ?label.</span>
<span class="s2">     ?art mo:performer ?performer. </span>
<span class="s2">     ?art etree:description ?description.</span>
<span class="s2">     ?performer foaf:name ?name.</span>
<span class="s2">     ?art event:place ?location.</span>
<span class="s2">     ?art etree:date ?date.</span>
<span class="s2">     ?location etree:location ?place.</span>
<span class="s2">     ?art event:hasSubEvent ?subEvent</span>
<span class="s2">     OPTIONAL {?performer etree:mbTag ?genre}.</span>
<span class="s2">     OPTIONAL {?subEvent calma:data ?calma}.</span>
<span class="s2">     &quot;&quot;&quot;</span>

    <span class="c1"># if customConditionType == &#39;AND&#39;:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">customSearchString</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
      <span class="n">customSearchString</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">customSearchString</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">customSearchString</span><span class="p">)</span>
    <span class="c1"># elif customConditionType == &#39;OR&#39;:</span>
    <span class="c1">#   customSearchString = &quot;\n ||&quot;.join(item for item in customSearchString)</span>
    <span class="c1"># else:</span>
    <span class="c1">#   customSearchString = &#39;&#39;</span>
    <span class="c1"># print(customSearchString)</span>

    <span class="c1"># Calculate date filters</span>
    <span class="n">dateString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">dateFrom</span><span class="p">,</span> <span class="n">dateTo</span><span class="p">)</span>

    <span class="c1"># If limit is 0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">limit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
      <span class="n">limit</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="c1"># If custom limit entered</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">limit</span> <span class="o">=</span> <span class="s1">&#39;LIMIT &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>

    <span class="c1"># Generate filters for artists, genres, locations</span>
    <span class="n">artistString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_parse</span><span class="p">(</span><span class="n">artists</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">genreString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_parse</span><span class="p">(</span><span class="n">genres</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">locationString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_parse</span><span class="p">(</span><span class="n">locations</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">trackString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_parse</span><span class="p">(</span><span class="n">trackName</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">venueString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_parse</span><span class="p">(</span><span class="n">venue</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">countriesString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_parse</span><span class="p">(</span><span class="n">countries</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">orderByString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_order_by</span><span class="p">(</span><span class="n">orderBy</span><span class="p">)</span>

    <span class="c1"># Add extra triples if required</span>
    <span class="c1">#if len(genreString) &gt; 2:</span>
      <span class="c1">#fields += &#39; ?genre&#39;</span>
      <span class="c1">#whereString += &#39;?performer etree:mbTag ?genre.&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trackString</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">fields</span> <span class="o">+=</span> <span class="s1">&#39; ?trackname&#39;</span>
      <span class="n">whereString</span> <span class="o">+=</span> <span class="s1">&#39;?track skos:prefLabel ?trackname.&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">venueString</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">fields</span> <span class="o">+=</span> <span class="s1">&#39; ?venue&#39;</span>
      <span class="n">whereString</span> <span class="o">+=</span> <span class="s1">&#39;?location etree:name ?venue.&#39;</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        PREFIX etree:&lt;http://etree.linkedmusic.org/vocab/&gt;</span>
<span class="s2">        PREFIX mo:&lt;http://purl.org/ontology/mo/&gt;</span>
<span class="s2">        PREFIX event:&lt;http://purl.org/NET/c4dm/event.owl#&gt;</span>
<span class="s2">        PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;</span>
<span class="s2">        PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>
<span class="s2">        PREFIX calma: &lt;http://calma.linkedmusic.org/vocab/&gt;</span>
<span class="s2">        </span>
<span class="s2">        SELECT DISTINCT ?label ?name ?place ?location ?date (group_concat(distinct ?calma; separator = &quot;</span><span class="se">\\</span><span class="s2">n&quot;) AS ?calma) WHERE {{</span>
<span class="s2">          </span><span class="si">{0}</span><span class="s2"></span>
<span class="s2">          </span><span class="si">{1}</span><span class="s2"></span>
<span class="s2">          </span><span class="si">{2}</span><span class="s2"></span>
<span class="s2">          </span><span class="si">{3}</span><span class="s2"></span>
<span class="s2">          </span><span class="si">{4}</span><span class="s2"></span>
<span class="s2">          </span><span class="si">{5}</span><span class="s2"></span>
<span class="s2">          </span><span class="si">{6}</span><span class="s2"></span>
<span class="s2">          </span><span class="si">{7}</span><span class="s2"></span>
<span class="s2">          </span><span class="si">{8}</span><span class="s2"></span>
<span class="s2">        }}</span>
<span class="s2">        </span><span class="si">{9}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{10}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">whereString</span><span class="p">,</span> <span class="n">artistString</span><span class="p">,</span> <span class="n">genreString</span><span class="p">,</span> <span class="n">locationString</span><span class="p">,</span> <span class="n">venueString</span><span class="p">,</span> <span class="n">dateString</span><span class="p">,</span> <span class="n">trackString</span><span class="p">,</span> <span class="n">customSearchString</span><span class="p">,</span>
                   <span class="n">countriesString</span><span class="p">,</span> <span class="n">orderByString</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">q</span></div>

<div class="viewcode-block" id="SPARQL.get_venue_information"><a class="viewcode-back" href="../test_build/sparql.html#sparql.SPARQL.get_venue_information">[docs]</a>  <span class="k">def</span> <span class="nf">get_venue_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves venue information for a particular release.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    label : string</span>
<span class="sd">        The release for which we want to retrieve the venue info of.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    resultsDict : dict</span>
<span class="sd">        A dictionary of a mixture of the GeoNames and LastFM data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">setQuery</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        PREFIX etree:&lt;http://etree.linkedmusic.org/vocab/&gt;</span>
<span class="s2">        PREFIX mo:&lt;http://purl.org/ontology/mo/&gt;</span>
<span class="s2">        PREFIX event:&lt;http://purl.org/NET/c4dm/event.owl#&gt;</span>
<span class="s2">        PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;</span>
<span class="s2">        PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>
<span class="s2">        PREFIX sim: &lt;http://purl.org/ontology/similarity/&gt;</span>

<span class="s2">        SELECT DISTINCT ?place ?location ?obj WHERE {{</span>
<span class="s2">                ?art skos:prefLabel &quot;</span><span class="si">{0}</span><span class="s2">&quot;.</span>
<span class="s2">                ?art event:place ?location.</span>
<span class="s2">                ?location sim:subjectOf ?external.</span>
<span class="s2">                ?external sim:object ?obj.</span>
<span class="s2">                ?location etree:location ?place.</span>
<span class="s2">        }} GROUP BY ?place ?location ?obj</span>
<span class="s2">                          &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>

    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
    <span class="n">resultsDict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;geoname&#39;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="s1">&#39;lastfm&#39;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">]:</span>
      <span class="k">if</span> <span class="s1">&#39;geoname&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;obj&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
        <span class="n">resultsDict</span><span class="p">[</span><span class="s1">&#39;geoname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;obj&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
      <span class="k">elif</span> <span class="s1">&#39;last.fm&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;obj&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
        <span class="n">resultsDict</span><span class="p">[</span><span class="s1">&#39;lastfm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;obj&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">resultsDict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultsDict</span></div>

<div class="viewcode-block" id="SPARQL.parse_order_by"><a class="viewcode-back" href="../test_build/sparql.html#sparql.SPARQL.parse_order_by">[docs]</a>  <span class="k">def</span> <span class="nf">parse_order_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orderBy</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a filter string for ordering by a give field.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    orderBy : str</span>
<span class="sd">      The input field.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    filterString : string</span>
<span class="sd">        An ORDER-BY string relative to the input field.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">translate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Artist&#39;</span> <span class="p">:</span> <span class="s1">&#39;?name&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Label&#39;</span> <span class="p">:</span> <span class="s1">&#39;?label&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Date&#39;</span> <span class="p">:</span> <span class="s1">&#39;?date&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Location&#39;</span> <span class="p">:</span> <span class="s1">&#39;?place&#39;</span>
                  <span class="p">}</span>

    <span class="k">return</span> <span class="s2">&quot;ORDER BY </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">translate</span><span class="p">[</span><span class="n">orderBy</span><span class="p">])</span></div>

<div class="viewcode-block" id="SPARQL.text_parse"><a class="viewcode-back" href="../test_build/sparql.html#sparql.SPARQL.text_parse">[docs]</a>  <span class="k">def</span> <span class="nf">text_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputList</span><span class="p">,</span> <span class="n">intType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates filter string for a given list, and type.</span>

<span class="sd">    A complex query may have several seperate filters applied, in which case it makes sense to move this into</span>
<span class="sd">    it&#39;s own class. The type is used to identify the attribute being filtered.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    inputList : string[]</span>
<span class="sd">      A list of filter conditions</span>

<span class="sd">    type : int</span>
<span class="sd">      The attribute to be filtered</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    filterString : string</span>
<span class="sd">        A appropriate filter string for the inputs</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If no data to process, return</span>
    <span class="k">if</span> <span class="n">inputList</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># Determine correct field</span>
    <span class="k">if</span> <span class="n">intType</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">fieldType</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;?name=</span><span class="se">\&quot;</span><span class="s2">&quot;&quot;&quot;</span>
    <span class="k">elif</span> <span class="n">intType</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">fieldType</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;?genre=</span><span class="se">\&quot;</span><span class="s2">&quot;&quot;&quot;</span>
    <span class="k">elif</span> <span class="n">intType</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
      <span class="n">fieldType</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;?place=</span><span class="se">\&quot;</span><span class="s2">&quot;&quot;&quot;</span>
    <span class="k">elif</span> <span class="n">intType</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
      <span class="n">fieldType</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;?trackname=</span><span class="se">\&quot;</span><span class="s2">&quot;&quot;&quot;</span>
    <span class="k">elif</span> <span class="n">intType</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
      <span class="n">fieldType</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;?venue=</span><span class="se">\&quot;</span><span class="s2">&quot;&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="p">(</span><span class="s1">&#39;No matching field type&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputList</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
      <span class="n">inputList</span> <span class="o">=</span> <span class="p">[</span><span class="n">inputList</span><span class="p">]</span>

    <span class="c1"># Join all possible filter clauses</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inputList</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
      <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="c1"># If matches requirement for filter string</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># Create filter string</span>
      <span class="n">filterString</span> <span class="o">=</span> <span class="s1">&#39;FILTER(&#39;</span>
      <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">inputList</span><span class="p">)):</span>
        <span class="n">filterString</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;    </span><span class="si">{0}{1}{2}</span><span class="s2">&quot; ||</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filterString</span><span class="p">,</span> <span class="n">fieldType</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
      <span class="n">filterString</span> <span class="o">=</span> <span class="n">filterString</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
      <span class="n">filterString</span> <span class="o">+=</span> <span class="s1">&#39;)</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">return</span> <span class="n">filterString</span></div>

<div class="viewcode-block" id="SPARQL.get_artist_from_tracklist"><a class="viewcode-back" href="../test_build/sparql.html#sparql.SPARQL.get_artist_from_tracklist">[docs]</a>  <span class="k">def</span> <span class="nf">get_artist_from_tracklist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tracklistURL</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the artist from a particular track-list.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tracklistURL : string</span>
<span class="sd">        A URL in the tracklist, for which we want to find the performer.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    artistName : str</span>
<span class="sd">        The name of the artist found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_string</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">          PREFIX etree:&lt;http://etree.linkedmusic.org/vocab/&gt;</span>
<span class="s2">          PREFIX mo:&lt;http://purl.org/ontology/mo/&gt;</span>
<span class="s2">          PREFIX event:&lt;http://purl.org/NET/c4dm/event.owl#&gt;</span>
<span class="s2">          PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;</span>
<span class="s2">          PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>

<span class="s2">          SELECT DISTINCT ?name WHERE </span>
<span class="s2">          {{   </span>
<span class="s2">               &lt;</span><span class="si">{0}</span><span class="s2">&gt; mo:performer ?performer.</span>
<span class="s2">               ?performer foaf:name ?name.</span>
<span class="s2">          }} LIMIT 1</span>
<span class="s2">           &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tracklistURL</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">name</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Cameron Allan.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>