
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>application &#8212; Meta-Data Browser for Live Music  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for application</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="k">try</span><span class="p">:</span>
  <span class="kn">import</span> <span class="nn">sys</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">)</span>
  <span class="kn">import</span> <span class="nn">time</span>
  <span class="kn">import</span> <span class="nn">os</span>
  <span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">atan2</span><span class="p">,</span> <span class="n">radians</span>
  <span class="kn">from</span> <span class="nn">PyQt5</span> <span class="k">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtMultimedia</span>
  <span class="kn">from</span> <span class="nn">UI</span> <span class="k">import</span> <span class="n">UI</span>
  <span class="kn">import</span> <span class="nn">sys</span>
  <span class="kn">import</span> <span class="nn">lastfm</span>
  <span class="kn">import</span> <span class="nn">maps</span>
  <span class="kn">import</span> <span class="nn">gi</span>
  <span class="kn">import</span> <span class="nn">traceback</span>
  <span class="kn">import</span> <span class="nn">json</span>
  <span class="kn">import</span> <span class="nn">sparql</span>
  <span class="kn">import</span> <span class="nn">re</span>
  <span class="kn">import</span> <span class="nn">cache</span>
  <span class="kn">import</span> <span class="nn">json</span>
  <span class="kn">import</span> <span class="nn">multithreading</span>
  <span class="kn">import</span> <span class="nn">audio</span>
  <span class="kn">import</span> <span class="nn">requests</span>
  <span class="kn">import</span> <span class="nn">calma</span>
  <span class="kn">import</span> <span class="nn">export</span>
  <span class="kn">import</span> <span class="nn">view</span>
  <span class="kn">import</span> <span class="nn">qtawesome</span> <span class="k">as</span> <span class="nn">qta</span>
  <span class="kn">from</span> <span class="nn">PyQt5.QtWebChannel</span> <span class="k">import</span> <span class="n">QWebChannel</span>
  <span class="kn">from</span> <span class="nn">PyQt5.QtWebEngineWidgets</span> <span class="k">import</span> <span class="n">QWebEngineView</span>
  <span class="kn">import</span> <span class="nn">hashlib</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="n">ModuleNotFoundError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You are missing package: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)[</span><span class="mi">15</span><span class="p">:])</span>
  <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<div class="viewcode-block" id="mainWindow"><a class="viewcode-back" href="../test_build/application.html#application.mainWindow">[docs]</a><span class="k">class</span> <span class="nc">mainWindow</span><span class="p">(</span><span class="n">UI</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dialog</span><span class="p">):</span>
    <span class="n">UI</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># UI</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="n">dialog</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_tooltips</span><span class="p">()</span>
    <span class="c1"># self.set_window_css()</span>

    <span class="c1"># Set-up handlers for classes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">searchHandler</span> <span class="o">=</span> <span class="n">SearchHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">audioHandler</span> <span class="o">=</span> <span class="n">audio</span><span class="o">.</span><span class="n">Audio</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span> <span class="o">=</span> <span class="n">sparql</span><span class="o">.</span><span class="n">SPARQL</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exporter</span> <span class="o">=</span> <span class="n">export</span><span class="o">.</span><span class="n">Export</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lastfmHandler</span> <span class="o">=</span> <span class="n">lastfm</span><span class="o">.</span><span class="n">lastfmAPI</span><span class="p">(</span><span class="s1">&#39;c957283a3dc3401e54b309ee2f18645b&#39;</span><span class="p">,</span> <span class="s1">&#39;f555ab4615197d1583eb2532b502c441&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">treeViewHandler</span> <span class="o">=</span> <span class="n">BrowseTreeViewHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">calmaHandler</span> <span class="o">=</span> <span class="n">calma</span><span class="o">.</span><span class="n">Calma</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nowPlayingHandler</span> <span class="o">=</span> <span class="n">NowPlaying</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">browseTreeProperties</span> <span class="o">=</span> <span class="n">TreePropertiesView</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">browseListHandler</span> <span class="o">=</span> <span class="n">BrowseListHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">childrenFetched</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Set-up volume controls</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">volumeSlider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">volumeSlider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">set_volume</span><span class="p">)</span>

    <span class="c1"># Set icons for playback</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">playPauseBtn</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">qta</span><span class="o">.</span><span class="n">icon</span><span class="p">(</span><span class="s1">&#39;fa.play&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prevBtn</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">qta</span><span class="o">.</span><span class="n">icon</span><span class="p">(</span><span class="s1">&#39;fa.step-backward&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nextBtn</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">qta</span><span class="o">.</span><span class="n">icon</span><span class="p">(</span><span class="s1">&#39;fa.step-forward&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lastfmBtn</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">qta</span><span class="o">.</span><span class="n">icon</span><span class="p">(</span><span class="s1">&#39;fa.lastfm&#39;</span><span class="p">))</span>

    <span class="c1"># Set-up preferred formats</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">formats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FLAC&#39;</span><span class="p">,</span> <span class="s1">&#39;SHN&#39;</span><span class="p">,</span> <span class="s1">&#39;MP3 (VBR)&#39;</span><span class="p">,</span> <span class="s1">&#39;OGG&#39;</span><span class="p">,</span> <span class="s1">&#39;MP3 (64Kbps)&#39;</span><span class="p">,</span> <span class="s1">&#39;WAV&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">format_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;FLAC&#39;</span> <span class="p">:</span> <span class="s1">&#39;.flac&#39;</span><span class="p">,</span> <span class="s1">&#39;MP3 (64Kbps)&#39;</span> <span class="p">:</span> <span class="s1">&#39;.64.mp3&#39;</span><span class="p">,</span> <span class="s1">&#39;SHN&#39;</span> <span class="p">:</span> <span class="s1">&#39;.shn&#39;</span><span class="p">,</span> <span class="s1">&#39;WAV&#39;</span> <span class="p">:</span> <span class="s1">&#39;.wav&#39;</span><span class="p">,</span> <span class="s1">&#39;OGG&#39;</span> <span class="p">:</span> <span class="s1">&#39;.ogg&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;MP3 (VBR)&#39;</span> <span class="p">:</span> <span class="s1">&#39;vbr.mp3&#39;</span><span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">playlists</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Playlist 1&#39;</span><span class="p">,</span> <span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">()}]</span>

    <span class="c1"># Set-up multi-threading pools</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">threadpool</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QThreadPool</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">audioThreadpool</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QThreadPool</span><span class="p">()</span>

    <span class="c1"># self.currentDateLabel.setText(str(&quot;On this day in history: &quot; + str(time.strftime(&quot;%A %dth of %B&quot;))))</span>

    <span class="c1"># Create map handler and class</span>
    <span class="c1">#self.mapHomeHandler = MapHandler(self, self.homeMapView)</span>
    <span class="c1">#self.homeMapView.loadFinished.connect(self.mapHomeHandler.get_on_this_day)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mapsPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/html/map.htm&quot;</span><span class="p">)</span>
    <span class="c1">#self.homeMapView.setUrl(QtCore.QUrl(&quot;file://&quot; + self.mapsPath))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">latlng</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;locationLatLng&#39;</span><span class="p">)</span>

    <span class="c1"># Initialize playlists</span>
    <span class="c1">#self.initialize_playlists()</span>

    <span class="c1"># If we already have a session key stored for Last.FM</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastfmHandler</span><span class="o">.</span><span class="n">hasSession</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
      <span class="c1"># Set button to red to indicate this</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lastfmBtn</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;QPushButton {</span>
<span class="s2">                                      background-color: #BA2024;</span>
<span class="s2">                                      }&quot;&quot;&quot;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lastfmStatus</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Connected to Last.FM&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># Set text to indicate user to connect to Last.FM</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lastfmStatus</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Connect to Last.FM&quot;</span><span class="p">)</span>

    <span class="c1"># Create data structure for storing search results</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">searchResults</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">searchesExecuted</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">searchTabElements</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Set-up signals for message passing</span>
    <span class="c1">#self.newPlaylistBtn.clicked.connect(self.new_playlist)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trackProgress</span><span class="o">.</span><span class="n">sliderReleased</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">track_seek</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treeViewHandler</span><span class="o">.</span><span class="n">expand_tree_item</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">doubleClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treeViewHandler</span><span class="o">.</span><span class="n">play_tree_item</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clickable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastfmStatus</span><span class="p">)</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_lastfm_status</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clickable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">playPauseBtn</span><span class="p">)</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">play_pause</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clickable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nextBtn</span><span class="p">)</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">next_click</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clickable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prevBtn</span><span class="p">)</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">previous_click</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">typeBrowseCombo</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browseListHandler</span><span class="o">.</span><span class="n">change_type</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">typeOrderByCombo</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browseListHandler</span><span class="o">.</span><span class="n">change_type_order</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">quickFilter</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browseListHandler</span><span class="o">.</span><span class="n">quick_filter_update</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">treeViewFilter</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treeViewHandler</span><span class="o">.</span><span class="n">tree_view_filter_update</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">browseList</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browseListHandler</span><span class="o">.</span><span class="n">browse_link_clicked</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">searchBtn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">searchHandler</span><span class="o">.</span><span class="n">perform_search</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">preferredFormatCombo</span><span class="o">.</span><span class="n">currentTextChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preferred_format_changed</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">playlist_view</span><span class="o">.</span><span class="n">doubleClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nowplaying_playlist_clicked</span><span class="p">)</span>

    <span class="c1"># Set-up debug dialog</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">debugDialog</span> <span class="o">=</span> <span class="n">DebugDialog</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">debugChk</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_window_state_changed</span><span class="p">)</span>

    <span class="c1"># Set-up now playing dialog</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">playlist_view</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>

    <span class="c1"># Hide header in tree-vew</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">header</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># Initialize map web channel (message passing between JS + Python)</span>
    <span class="c1">#self.initialize_web_channel(self.homeMapView)</span>

    <span class="c1"># Set-up advanced search signals</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">addConditionBtn</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">searchHandler</span><span class="o">.</span><span class="n">add_custom_condition</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">removeConditionBtn</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">searchHandler</span><span class="o">.</span><span class="n">remove_custom_condition</span><span class="p">)</span>

    <span class="c1"># Set-up search auto-complete</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">artistFilter</span><span class="o">.</span><span class="n">setCompleter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auto_comp</span><span class="p">(</span><span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;artistList&#39;</span><span class="p">)))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">genreFilter</span><span class="o">.</span><span class="n">setCompleter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auto_comp</span><span class="p">(</span><span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;genreList&#39;</span><span class="p">)))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">locationFilter</span><span class="o">.</span><span class="n">setCompleter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auto_comp</span><span class="p">(</span><span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;newReversedGroupedLocations&#39;</span><span class="p">)))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">countryFilter</span><span class="o">.</span><span class="n">setCompleter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auto_comp</span><span class="p">(</span><span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;countries&#39;</span><span class="p">)))</span>

    <span class="c1"># Create menu</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">setContextMenuPolicy</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CustomContextMenu</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">customContextMenuRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_tree_menu</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QTreeView::item { height: 50px;}&quot;</span><span class="p">)</span>

    <span class="c1"># Set our model to the browsing list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">browseList</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browseListHandler</span><span class="o">.</span><span class="n">artistListModel</span><span class="p">)</span>

    <span class="c1"># Create history table</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initialize_history_table</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">searchHandler</span><span class="o">.</span><span class="n">add_search_tab_contents</span><span class="p">()</span>

<div class="viewcode-block" id="mainWindow.debug_window_state_changed"><a class="viewcode-back" href="../test_build/application.html#application.mainWindow.debug_window_state_changed">[docs]</a>  <span class="k">def</span> <span class="nf">debug_window_state_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">debugDialog</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">debugDialog</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span></div>

<div class="viewcode-block" id="mainWindow.nowplaying_playlist_clicked"><a class="viewcode-back" href="../test_build/application.html#application.mainWindow.nowplaying_playlist_clicked">[docs]</a>  <span class="k">def</span> <span class="nf">nowplaying_playlist_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">start_audio_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">playlist</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">row</span><span class="p">()][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="mainWindow.initialize_web_channel"><a class="viewcode-back" href="../test_build/application.html#application.mainWindow.initialize_web_channel">[docs]</a>  <span class="k">def</span> <span class="nf">initialize_web_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
    <span class="c1"># Set-up web channel between python + JS components</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mapChannel</span> <span class="o">=</span> <span class="n">QWebChannel</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mapHandler</span> <span class="o">=</span> <span class="n">CallHandler</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mapChannel</span><span class="o">.</span><span class="n">registerObject</span><span class="p">(</span><span class="s1">&#39;mapHandler&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapHandler</span><span class="p">)</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">setWebChannel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapChannel</span><span class="p">)</span></div>

<div class="viewcode-block" id="mainWindow.preferred_format_changed"><a class="viewcode-back" href="../test_build/application.html#application.mainWindow.preferred_format_changed">[docs]</a>  <span class="k">def</span> <span class="nf">preferred_format_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
    <span class="c1"># Change format to new preferred</span>
    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formats</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="c1"># self.format_dict[item]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">formats</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">formats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formats</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">formats</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">debugDialog</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">: set new preferred format to </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">formats</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>

  <span class="c1"># def increment_searches_executed(self):</span>
  <span class="c1">#   self.searchesExecuted += 1</span>

<div class="viewcode-block" id="mainWindow.initialize_history_table"><a class="viewcode-back" href="../test_build/application.html#application.mainWindow.initialize_history_table">[docs]</a>  <span class="k">def</span> <span class="nf">initialize_history_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Load from file the previous history</span>
    <span class="c1">#self.track_history = [[&#39;Track Name&#39;, &#39;Artist Name&#39;, &#39;13:00:24 21.01.17&#39;, &#39;Live at Venue&#39;, &#39;URL&#39;]]</span>
    <span class="c1">#cache.save(self.track_history, &#39;play_history&#39;)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">track_history</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;play_history&#39;</span><span class="p">)</span>

    <span class="c1"># Set-up properties</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">historyTableWidget</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">historyTableWidget</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">track_history</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">historyTableWidget</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">([</span><span class="s1">&#39;Track&#39;</span><span class="p">,</span> <span class="s1">&#39;Artist&#39;</span><span class="p">,</span> <span class="s1">&#39;Date Played&#39;</span><span class="p">,</span> <span class="s1">&#39;Recording&#39;</span><span class="p">])</span>
    <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">historyTableWidget</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span>
    <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">Stretch</span><span class="p">)</span>
    <span class="n">header</span><span class="o">.</span><span class="n">setStretchLastSection</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Add data</span>
    <span class="n">rowIndex</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">track_played</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">track_history</span><span class="p">:</span>
      <span class="n">columnIndex</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">track_played</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="c1"># Set item at appropriate indexes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">historyTableWidget</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">rowIndex</span><span class="p">,</span> <span class="n">columnIndex</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="p">)))</span>
        <span class="n">columnIndex</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="n">rowIndex</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Format table nicely</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">historyTableWidget</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">historyTableWidget</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">historyTableWidget</span><span class="o">.</span><span class="n">setSortingEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">historyTableWidget</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Create layout for search tab</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">searchTabWidgetLayout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">searchTabWidgetLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">searchTabWidget</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">searchTab</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">searchTabWidgetLayout</span><span class="p">)</span></div>

<div class="viewcode-block" id="mainWindow.append_history_table"><a class="viewcode-back" href="../test_build/application.html#application.mainWindow.append_history_table">[docs]</a>  <span class="k">def</span> <span class="nf">append_history_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">track_name</span><span class="p">,</span> <span class="n">artist</span><span class="p">,</span> <span class="n">recording_label</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">track_history</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">track_name</span><span class="p">,</span> <span class="n">artist</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;{%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S}&#39;</span><span class="p">),</span> <span class="n">recording_label</span><span class="p">,</span> <span class="n">url</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initialize_history_table</span><span class="p">()</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">track_history</span><span class="p">,</span> <span class="s1">&#39;track_history&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="mainWindow.scrobble_track_lastfm"><a class="viewcode-back" href="../test_build/application.html#application.mainWindow.scrobble_track_lastfm">[docs]</a>  <span class="k">def</span> <span class="nf">scrobble_track_lastfm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hit scrobble signal&#39;</span><span class="p">)</span>
    <span class="c1"># self.playlist[self.playlist_index][1]</span>
    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">playlist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">playlist_index</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">artist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">get_artist_from_tracklist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">playlist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">playlist_index</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lastfmHandler</span><span class="o">.</span><span class="n">update_now_playing</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">playlist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">playlist_index</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="mainWindow.playlist_clicked"><a class="viewcode-back" href="../test_build/application.html#application.mainWindow.playlist_clicked">[docs]</a>  <span class="k">def</span> <span class="nf">playlist_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">playlists</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">():</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span>

        <span class="c1"># self.selectedPlaylistModel = QtGui.QStandardItemModel(self.playlistTreeView)</span>
        <span class="c1"># self.generateModels(items, self.selectedPlaylistModel)</span>

        <span class="c1"># Set our model to the browsing list</span>
        <span class="n">items</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="s1">&#39;Test Item&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">playlistTreeView</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="c1"># with open(&#39;data/playlists.mmd&#39;, &#39;w&#39;) as outfile:</span>
        <span class="c1">#   json.dump(self.playlists, outfile)</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">items</span><span class="p">))</span></div>

<div class="viewcode-block" id="mainWindow.auto_comp"><a class="viewcode-back" href="../test_build/application.html#application.mainWindow.auto_comp">[docs]</a>  <span class="k">def</span> <span class="nf">auto_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates and returns an auto-completer with the input list.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    inputList : str[]</span>
<span class="sd">        The input list providing the model for the auto-completer.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># If the inputList is a dict</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">inputList</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="nb">dict</span><span class="p">()):</span>
      <span class="c1"># Convert to list first</span>
      <span class="n">tempList</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputList</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">tempList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
      <span class="n">inputList</span> <span class="o">=</span> <span class="n">tempList</span>

    <span class="c1"># Create qCompleter instance with input list</span>
    <span class="n">lineEditCompleter</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QCompleter</span><span class="p">(</span><span class="n">inputList</span><span class="p">)</span>

    <span class="c1"># Return to be set to the relevant GUI text-box</span>
    <span class="k">return</span> <span class="n">lineEditCompleter</span></div>

  <span class="c1"># def initialize_playlists(self):</span>
  <span class="c1">#   # Create model for our playlist view</span>
  <span class="c1">#   self.playlistModel = QtGui.QStandardItemModel(self.playlistTreeView)</span>
  <span class="c1">#</span>
  <span class="c1">#   # Append each to model</span>
  <span class="c1">#   for playlist in self.playlists:</span>
  <span class="c1">#     item = QtGui.QStandardItem(playlist[&#39;name&#39;])</span>
  <span class="c1">#     self.playlistModel.appendRow(item)</span>
  <span class="c1">#</span>
  <span class="c1">#   # Set our list model to our new created model</span>
  <span class="c1">#   self.playlistList.setModel(self.playlistModel)</span>
  <span class="c1">#</span>
  <span class="c1"># def new_playlist(self):</span>
  <span class="c1">#   # self.playlists.append([&quot;New Playlist&quot;, []])</span>
  <span class="c1">#</span>
  <span class="c1">#   with open(&#39;data/playlists.mmd&#39;, &#39;w&#39;) as outfile:</span>
  <span class="c1">#     json.dump(self.playlists, outfile)</span>

<div class="viewcode-block" id="mainWindow.set_tooltips"><a class="viewcode-back" href="../test_build/application.html#application.mainWindow.set_tooltips">[docs]</a>  <span class="k">def</span> <span class="nf">set_tooltips</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets up help tooltips which appear when the user hovers over a particular widget.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">repeatCombo</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Playback behaviour for after a track finishes&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nextBtn</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Skip to the next track&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prevBtn</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Skip to the previous track&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">playPauseBtn</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Play or pause the current track&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lastfmBtn</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;View Last.FM status&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">timeLbl</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;The current position in the track&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trackLbl</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Currently playing track name&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trackProgress</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Press to seek to a specific time&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">volumeLbl</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Change the volume of the music playing&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">volumeSlider</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Slide to adjust volume&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">nowPlayingTab</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Provides information about the release currently being played&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">browseTab</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Browse the meta-data&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="mainWindow.open_tree_menu"><a class="viewcode-back" href="../test_build/application.html#application.mainWindow.open_tree_menu">[docs]</a>  <span class="k">def</span> <span class="nf">open_tree_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Called when the user requests a context menu from the tree view.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>

<span class="sd">    pos : QStandardItem</span>
<span class="sd">        The item the user right clicked on</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">menu_on_item</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>

    <span class="c1"># Calculate number of levels</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="n">index</span> <span class="o">=</span> <span class="n">indexes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">while</span> <span class="n">index</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
        <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>

      <span class="c1"># Create menu</span>
      <span class="n">menu</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMenu</span><span class="p">()</span>
      <span class="n">exportFormatMenu</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMenu</span><span class="p">(</span><span class="s2">&quot;Export Data&quot;</span><span class="p">)</span>
      <span class="n">menu</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_browse_menu_click</span><span class="p">)</span>

      <span class="c1"># If performance</span>
      <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QT_TR_NOOP</span><span class="p">(</span><span class="s2">&quot;Expand Item&quot;</span><span class="p">))</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QT_TR_NOOP</span><span class="p">(</span><span class="s2">&quot;Collapse Item&quot;</span><span class="p">))</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="n">exportFormatMenu</span><span class="p">)</span>
        <span class="n">exportFormatMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;JSON&#39;</span><span class="p">)</span>
        <span class="n">exportFormatMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;CSV&#39;</span><span class="p">)</span>
        <span class="n">exportFormatMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;XML&#39;</span><span class="p">)</span>
        <span class="n">exportFormatMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;M3U&#39;</span><span class="p">)</span>
      <span class="c1"># If track</span>
      <span class="k">elif</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QT_TR_NOOP</span><span class="p">(</span><span class="s2">&quot;Expand Item&quot;</span><span class="p">))</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QT_TR_NOOP</span><span class="p">(</span><span class="s2">&quot;Collapse Item&quot;</span><span class="p">))</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QT_TR_NOOP</span><span class="p">(</span><span class="s2">&quot;Play All Renditions&quot;</span><span class="p">))</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="n">exportFormatMenu</span><span class="p">)</span>
        <span class="n">exportFormatMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;JSON&#39;</span><span class="p">)</span>
        <span class="n">exportFormatMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;CSV&#39;</span><span class="p">)</span>
        <span class="n">exportFormatMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;XML&#39;</span><span class="p">)</span>
        <span class="n">exportFormatMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;M3U&#39;</span><span class="p">)</span>

      <span class="c1"># Map menu to the view-port</span>
      <span class="n">menu</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">viewport</span><span class="p">()</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span></div>

<div class="viewcode-block" id="mainWindow.tree_browse_menu_click"><a class="viewcode-back" href="../test_build/application.html#application.mainWindow.tree_browse_menu_click">[docs]</a>  <span class="k">def</span> <span class="nf">tree_browse_menu_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes use of the menu in the tree view.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>

<span class="sd">    index : int</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">contextRow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">indexAt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">menu_on_item</span><span class="p">)</span>

    <span class="c1"># Process menu options</span>
    <span class="k">if</span> <span class="s1">&#39;Collapse&#39;</span> <span class="ow">in</span> <span class="n">index</span><span class="o">.</span><span class="n">text</span><span class="p">():</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">setExpanded</span><span class="p">(</span><span class="n">contextRow</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">indexAt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">menu_on_item</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="s1">&#39;Expand&#39;</span> <span class="ow">in</span> <span class="n">index</span><span class="o">.</span><span class="n">text</span><span class="p">():</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">setExpanded</span><span class="p">(</span><span class="n">contextRow</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">indexAt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">menu_on_item</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="s1">&#39;JSON&#39;</span> <span class="o">==</span> <span class="n">index</span><span class="o">.</span><span class="n">text</span><span class="p">():</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">exporter</span><span class="o">.</span><span class="n">export_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">get_release_properties</span><span class="p">(</span><span class="n">contextRow</span><span class="o">.</span><span class="n">data</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_translation_uri</span><span class="p">(),</span> <span class="s1">&#39;JSON&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;CSV&#39;</span> <span class="o">==</span> <span class="n">index</span><span class="o">.</span><span class="n">text</span><span class="p">():</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">exporter</span><span class="o">.</span><span class="n">export_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">get_release_properties</span><span class="p">(</span><span class="n">contextRow</span><span class="o">.</span><span class="n">data</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_translation_uri</span><span class="p">(),</span> <span class="s1">&#39;CSV&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;XML&#39;</span> <span class="o">==</span> <span class="n">index</span><span class="o">.</span><span class="n">text</span><span class="p">():</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">exporter</span><span class="o">.</span><span class="n">export_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">get_release_properties</span><span class="p">(</span><span class="n">contextRow</span><span class="o">.</span><span class="n">data</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_translation_uri</span><span class="p">(),</span> <span class="s1">&#39;XML&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;M3U&#39;</span> <span class="o">==</span> <span class="n">index</span><span class="o">.</span><span class="n">text</span><span class="p">():</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">exporter</span><span class="o">.</span><span class="n">export_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">get_release_properties</span><span class="p">(</span><span class="n">contextRow</span><span class="o">.</span><span class="n">data</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_translation_uri</span><span class="p">(),</span>  <span class="s1">&#39;M3U&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No matching menu item&#39;</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">indexAt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">menu_on_item</span><span class="p">)))</span>
      <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">contextRow</span><span class="o">.</span><span class="n">data</span><span class="p">()))</span></div>

<div class="viewcode-block" id="mainWindow.clickable"><a class="viewcode-back" href="../test_build/application.html#application.mainWindow.clickable">[docs]</a>  <span class="k">def</span> <span class="nf">clickable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">associatedWidget</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Filter</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">):</span>
      <span class="n">clickedSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">()</span>

      <span class="k">def</span> <span class="nf">eventFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">user_event</span><span class="p">):</span>
        <span class="c1"># If this object matches the one we wish to have an action performed on</span>
        <span class="k">if</span> <span class="nb">object</span> <span class="o">==</span> <span class="n">associatedWidget</span><span class="p">:</span>
          <span class="c1"># If the event was a click, and not another QEvent</span>
          <span class="k">if</span> <span class="n">user_event</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QEvent</span><span class="o">.</span><span class="n">MouseButtonRelease</span><span class="p">:</span>
            <span class="c1"># Ensure that the object contains the user event that occured</span>
            <span class="k">if</span> <span class="nb">object</span><span class="o">.</span><span class="n">rect</span><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">user_event</span><span class="o">.</span><span class="n">pos</span><span class="p">()):</span>
              <span class="c1"># Emit a signal</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">clickedSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
              <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">filterOfWidget</span> <span class="o">=</span> <span class="n">Filter</span><span class="p">(</span><span class="n">associatedWidget</span><span class="p">)</span>
    <span class="n">associatedWidget</span><span class="o">.</span><span class="n">installEventFilter</span><span class="p">(</span><span class="n">filterOfWidget</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">filterOfWidget</span><span class="o">.</span><span class="n">clickedSignal</span></div>

<div class="viewcode-block" id="mainWindow.check_lastfm_status"><a class="viewcode-back" href="../test_build/application.html#application.mainWindow.check_lastfm_status">[docs]</a>  <span class="k">def</span> <span class="nf">check_lastfm_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks whether we have an existing Last.FM session, and if not,</span>
<span class="sd">    initiates authentication with the API.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If we do not have a Last.FM session key already</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastfmHandler</span><span class="o">.</span><span class="n">hasSession</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
      <span class="c1"># Generate token</span>
      <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastfmHandler</span><span class="o">.</span><span class="n">request_auth_token</span><span class="p">()</span>

      <span class="c1"># Create browser dialog for user authentication</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">browserDialog</span> <span class="o">=</span> <span class="n">QWebEngineView</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">browserDialog</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Connect to Last.FM&quot;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">browserDialog</span><span class="o">.</span><span class="n">setUrl</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QUrl</span><span class="p">(</span><span class="s2">&quot;https://last.fm/api/auth/?api_key=&quot;</span>
                                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastfmHandler</span><span class="o">.</span><span class="n">getAPIKey</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;&amp;token=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">)))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">browserDialog</span><span class="o">.</span><span class="n">urlChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastfmHandler</span><span class="o">.</span><span class="n">request_session_key</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">browserDialog</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="c1"># If we have a Last.FM session, change button colour to reflect that</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lastfmBtn</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;QPushButton {</span>
<span class="s2">                                      background-color: #BA2024;</span>
<span class="s2">                                    }&quot;&quot;&quot;</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="BrowseListHandler"><a class="viewcode-back" href="../test_build/application.html#application.BrowseListHandler">[docs]</a><span class="k">class</span> <span class="nc">BrowseListHandler</span><span class="p">():</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>

    <span class="c1"># Load lists of artists, genres, etc</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">artistList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;artistList&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">artistList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Unknown Artist&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">genreList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;genreList&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">locationList</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;newReversedGroupedLocations&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">artistListModel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">browseList</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">genreListModel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">browseList</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">locationListModel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">browseList</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">generate_browse_models</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">artistList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">artistListModel</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">generate_browse_models</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">genreList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">genreListModel</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">generate_location_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locationList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">locationListModel</span><span class="p">)</span>

    <span class="k">return</span>

<div class="viewcode-block" id="BrowseListHandler.change_type"><a class="viewcode-back" href="../test_build/application.html#application.BrowseListHandler.change_type">[docs]</a>  <span class="k">def</span> <span class="nf">change_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes the model shown to the user for browsing the meta-data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    type : int</span>
<span class="sd">        The index corresponding to the new browse model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Update model relative to &#39;type&#39;</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">browseList</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">artistListModel</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">browseList</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">genreListModel</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">browseList</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locationListModel</span><span class="p">)</span>

    <span class="c1"># Change type order for new list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">change_type_order</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">typeOrderByCombo</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span>

    <span class="k">return</span></div>

<div class="viewcode-block" id="BrowseListHandler.quick_filter_update"><a class="viewcode-back" href="../test_build/application.html#application.BrowseListHandler.quick_filter_update">[docs]</a>  <span class="k">def</span> <span class="nf">quick_filter_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides filter functionality for the browsing models.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get text in filter box</span>
    <span class="n">searchStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">quickFilter</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>  <span class="c1"># Created a QlineEdit to input search strings</span>

    <span class="c1"># Perform a &quot;CONTAINS&quot; search on the model</span>
    <span class="n">itemsFound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">browseList</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">findItems</span><span class="p">(</span><span class="n">searchStr</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">MatchContains</span><span class="p">)</span>

    <span class="c1"># If items found</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">itemsFound</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itemsFound</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">searchStr</span><span class="p">:</span>
          <span class="c1"># Remove row from it&#39;s current position</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">browseList</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">takeRow</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">row</span><span class="p">())</span>

          <span class="c1"># Move the row to the top of the list</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">browseList</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">insertRow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="BrowseListHandler.browse_link_clicked"><a class="viewcode-back" href="../test_build/application.html#application.BrowseListHandler.browse_link_clicked">[docs]</a>  <span class="k">def</span> <span class="nf">browse_link_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds items relative to the clicked browse item, to the tree view.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>

<span class="sd">    item : QStandardItem</span>
<span class="sd">        The item clicked</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s1">&#39;Genre&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">typeBrowseCombo</span><span class="o">.</span><span class="n">currentText</span><span class="p">():</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">treeViewHandler</span><span class="o">.</span><span class="n">update_tree_view</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">elif</span> <span class="s1">&#39;Location&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">typeBrowseCombo</span><span class="o">.</span><span class="n">currentText</span><span class="p">():</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">treeViewHandler</span><span class="o">.</span><span class="n">update_tree_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">locationList</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="p">()][</span><span class="s1">&#39;locations&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">treeViewHandler</span><span class="o">.</span><span class="n">update_tree_view</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="p">())</span></div>

<div class="viewcode-block" id="BrowseListHandler.generate_browse_models"><a class="viewcode-back" href="../test_build/application.html#application.BrowseListHandler.generate_browse_models">[docs]</a>  <span class="k">def</span> <span class="nf">generate_browse_models</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes an input list and an empty model, and fills said model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    list : str[]</span>
<span class="sd">        The input list of items for the model</span>
<span class="sd">    model : QStandardItemModel</span>
<span class="sd">        An empty model for QStandardItems</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">:</span>
      <span class="n">item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
      <span class="n">model</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="BrowseListHandler.generate_location_model"><a class="viewcode-back" href="../test_build/application.html#application.BrowseListHandler.generate_location_model">[docs]</a>  <span class="k">def</span> <span class="nf">generate_location_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes an input dict of locations and an empty model, and fills said model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    dict : dictionary</span>
<span class="sd">        The input dictionary of locations for the model</span>
<span class="sd">    model : QStandardItemModel</span>
<span class="sd">        An empty model for QStandardItems</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">:</span>
      <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; - &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()):</span>
      <span class="n">temp</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
      <span class="n">model</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span></div>

<div class="viewcode-block" id="BrowseListHandler.change_type_order"><a class="viewcode-back" href="../test_build/application.html#application.BrowseListHandler.change_type_order">[docs]</a>  <span class="k">def</span> <span class="nf">change_type_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes the order of the browse model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    index : int</span>
<span class="sd">        The index corresponding to the new type order</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">types</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Set the appropriate list and model relative to the</span>
    <span class="c1"># browsing model</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">typeBrowseCombo</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Artist&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">artistListModel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">()</span>
      <span class="nb">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">artistListModel</span>
      <span class="n">loadedList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">artistList</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">typeBrowseCombo</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Genre&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">genreListModel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">()</span>
      <span class="nb">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">genreListModel</span>
      <span class="n">loadedList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">genreList</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">typeBrowseCombo</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Location&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">locationListModel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">()</span>
      <span class="nb">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">locationListModel</span>
      <span class="n">loadedList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">locationList</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
      <span class="n">loadedList</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># If not managing locations</span>
    <span class="k">if</span> <span class="n">loadedList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">locationList</span><span class="p">:</span>
      <span class="c1"># AZ</span>
      <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_browse_models</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">loadedList</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">(),</span> <span class="n">x</span><span class="p">))),</span> <span class="nb">type</span><span class="p">)</span>
      <span class="c1"># ZA</span>
      <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_browse_models</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">loadedList</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">(),</span> <span class="n">x</span><span class="p">)))),</span> <span class="nb">type</span><span class="p">)</span>
    <span class="c1"># If handling locations</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># AZ</span>
      <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_location_model</span><span class="p">(</span><span class="n">loadedList</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
      <span class="c1"># ZA</span>
      <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">location_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">loadedList</span><span class="p">:</span>
          <span class="n">location_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="c1"># Add row to models</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">location_list</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)))):</span>
          <span class="n">temp</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
          <span class="nb">type</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

    <span class="c1"># Set browse list model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">browseList</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="TreePropertiesView"><a class="viewcode-back" href="../test_build/application.html#application.TreePropertiesView">[docs]</a><span class="k">class</span> <span class="nc">TreePropertiesView</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeView</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>
    <span class="k">return</span>

<div class="viewcode-block" id="TreePropertiesView.get_translation_uri"><a class="viewcode-back" href="../test_build/application.html#application.TreePropertiesView.get_translation_uri">[docs]</a>  <span class="k">def</span> <span class="nf">get_translation_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&#39;</span> <span class="p">:</span> <span class="s1">&#39;Type&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://www.w3.org/2000/01/rdf-schema#seeAlso&#39;</span> <span class="p">:</span> <span class="s1">&#39;See Also&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://purl.org/ontology/mo/performer&#39;</span> <span class="p">:</span> <span class="s1">&#39;Performer&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://etree.linkedmusic.org/vocab/date&#39;</span> <span class="p">:</span> <span class="s1">&#39;Date&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://etree.linkedmusic.org/vocab/description&#39;</span> <span class="p">:</span> <span class="s1">&#39;Description&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://etree.linkedmusic.org/vocab/id&#39;</span> <span class="p">:</span> <span class="s1">&#39;ID&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://etree.linkedmusic.org/vocab/keyword&#39;</span> <span class="p">:</span> <span class="s1">&#39;Keyword(s)&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://etree.linkedmusic.org/vocab/lineage&#39;</span> <span class="p">:</span> <span class="s1">&#39;Lineage&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://etree.linkedmusic.org/vocab/notes&#39;</span> <span class="p">:</span> <span class="s1">&#39;Notes&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://etree.linkedmusic.org/vocab/source&#39;</span> <span class="p">:</span> <span class="s1">&#39;Source&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://etree.linkedmusic.org/vocab/uploader&#39;</span> <span class="p">:</span> <span class="s1">&#39;Uploader&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://purl.org/NET/c4dm/event.owl#place&#39;</span> <span class="p">:</span> <span class="s1">&#39;Place&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://www.w3.org/2004/02/skos/core#prefLabel&#39;</span> <span class="p">:</span> <span class="s1">&#39;Label&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://purl.org/NET/c4dm/event.owl#hasSubEvent&#39;</span> <span class="p">:</span> <span class="s1">&#39;Has Sub Event&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://purl.org/NET/c4dm/event.owl#time&#39;</span> <span class="p">:</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://etree.linkedmusic.org/vocab/audio&#39;</span> <span class="p">:</span> <span class="s1">&#39;Audio URL&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://etree.linkedmusic.org/vocab/isSubEventOf&#39;</span> <span class="p">:</span> <span class="s1">&#39;Sub Events&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://etree.linkedmusic.org/vocab/number&#39;</span> <span class="p">:</span> <span class="s1">&#39;Track Number&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://purl.org/ontology/mo/performed&#39;</span> <span class="p">:</span> <span class="s1">&#39;Performances&#39;</span><span class="p">,</span>
              <span class="s1">&#39;http://xmlns.com/foaf/0.1/name&#39;</span> <span class="p">:</span> <span class="s1">&#39;Name&#39;</span>
              <span class="p">}</span>

    <span class="k">return</span> <span class="n">labels</span></div>

<div class="viewcode-block" id="TreePropertiesView.retrieve_properties_subwindow"><a class="viewcode-back" href="../test_build/application.html#application.TreePropertiesView.retrieve_properties_subwindow">[docs]</a>  <span class="k">def</span> <span class="nf">retrieve_properties_subwindow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides a properties view for a given performance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>

<span class="sd">    index : int</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get labels dictionary for translation to human-readable formats</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_translation_uri</span><span class="p">()</span>

    <span class="c1"># Retrieve properties for this release</span>
    <span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">get_release_subproperties</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">())</span>

    <span class="c1"># Group together attributes again</span>
    <span class="k">for</span> <span class="nb">property</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">]:</span>
      <span class="n">treeViewPropertiesDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_properties</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

      <span class="c1"># Set to child of item</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">treeViewPropertiesDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">treeViewPropertiesDict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
          <span class="k">try</span><span class="p">:</span>
            <span class="n">labelItem</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
          <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">labelItem</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
          <span class="n">model</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">setChild</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">labelItem</span><span class="p">)</span>
          <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

          <span class="c1"># Put children in a tree-esque format</span>
          <span class="n">e</span> <span class="o">=</span> <span class="mi">0</span>
          <span class="k">for</span> <span class="nb">property</span> <span class="ow">in</span> <span class="n">treeViewPropertiesDict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
            <span class="n">propertyItem</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="nb">property</span><span class="p">)</span>
            <span class="n">labelItem</span><span class="o">.</span><span class="n">setChild</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">propertyItem</span><span class="p">)</span>
            <span class="n">e</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="TreePropertiesView.retrieve_release_info"><a class="viewcode-back" href="../test_build/application.html#application.TreePropertiesView.retrieve_release_info">[docs]</a>  <span class="k">def</span> <span class="nf">retrieve_release_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">release</span><span class="p">):</span>
    <span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">get_release_properties</span><span class="p">(</span><span class="n">release</span><span class="p">)</span>
    <span class="c1">#self.TreeViewProperties = QtWidgets.QTreeView(self.additionalInfoFrame)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">additionalInfoFrame</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">treePropertiesModel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fill_properties_tree_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treePropertiesModel</span><span class="p">,</span> <span class="n">properties</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">()</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">800</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>

    <span class="c1"># Set our model to the browsing list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treePropertiesModel</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">doubleClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_properties_subwindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span>  <span class="bp">self</span><span class="o">.</span><span class="n">treePropertiesModel</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="TreePropertiesView.fill_properties_tree_view"><a class="viewcode-back" href="../test_build/application.html#application.TreePropertiesView.fill_properties_tree_view">[docs]</a>  <span class="k">def</span> <span class="nf">fill_properties_tree_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">properties</span><span class="p">):</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_translation_uri</span><span class="p">()</span>
    <span class="n">treeViewPropertiesDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_properties</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">treeViewPropertiesDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">treeViewPropertiesDict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="c1"># Create first level of tree using keyword</span>
        <span class="n">labelItem</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="n">model</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">labelItem</span><span class="p">)</span>

        <span class="c1"># Create children in tree for each property</span>
        <span class="n">e</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="nb">property</span> <span class="ow">in</span> <span class="n">treeViewPropertiesDict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
          <span class="n">propertyItem</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="nb">property</span><span class="p">)</span>
          <span class="n">labelItem</span><span class="o">.</span><span class="n">setChild</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">propertyItem</span><span class="p">)</span>
          <span class="n">e</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="TreePropertiesView.group_properties"><a class="viewcode-back" href="../test_build/application.html#application.TreePropertiesView.group_properties">[docs]</a>  <span class="k">def</span> <span class="nf">group_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">properties</span><span class="p">):</span>
    <span class="n">treeViewPropertiesDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="nb">property</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">]:</span>
      <span class="k">if</span> <span class="nb">property</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">treeViewPropertiesDict</span><span class="p">:</span>
        <span class="n">treeViewPropertiesDict</span><span class="p">[</span><span class="nb">property</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">treeViewPropertiesDict</span><span class="p">[</span><span class="nb">property</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">property</span><span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">treeViewPropertiesDict</span></div></div>

<div class="viewcode-block" id="SearchHandler"><a class="viewcode-back" href="../test_build/application.html#application.SearchHandler">[docs]</a><span class="k">class</span> <span class="nc">SearchHandler</span><span class="p">():</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span> <span class="o">=</span> <span class="n">main</span>

<div class="viewcode-block" id="SearchHandler.add_search_tab_contents"><a class="viewcode-back" href="../test_build/application.html#application.SearchHandler.add_search_tab_contents">[docs]</a>  <span class="k">def</span> <span class="nf">add_search_tab_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Add search there by default</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">searchTabWidget</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

    <span class="c1"># Get results for this day</span>
    <span class="c1"># Create view</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;results&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;bindings&#39;</span> <span class="p">:</span> <span class="p">[]}},</span> <span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="s1">&#39;timeline&#39;</span><span class="p">,</span> <span class="s1">&#39;table&#39;</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">searchTabWidget</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">searchTab</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">takeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">searchTab</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">get_layout</span><span class="p">())</span></div>
    <span class="c1"># self.view = view.View(self.main, self, [&#39;map&#39;, &#39;timeline&#39;, &#39;table&#39;], self.main.mapHandler.get_on_this_day(), False, self.main.searchTabWidget)</span>

<div class="viewcode-block" id="SearchHandler.add_custom_condition"><a class="viewcode-back" href="../test_build/application.html#application.SearchHandler.add_custom_condition">[docs]</a>  <span class="k">def</span> <span class="nf">add_custom_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Each custom condition consists of groups of 3 widgets</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3</span>

    <span class="c1"># Add to appropriate indexes our new row of widgets</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_field_combo</span><span class="p">(),</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_condition_combo</span><span class="p">(),</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(),</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Add auto-completion where appropriate</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update_auto_complete</span><span class="p">()</span></div>
<div class="viewcode-block" id="SearchHandler.remove_custom_condition"><a class="viewcode-back" href="../test_build/application.html#application.SearchHandler.remove_custom_condition">[docs]</a>  <span class="k">def</span> <span class="nf">remove_custom_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Get 3 last items in the layout and remove them</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="SearchHandler.generate_field_combo"><a class="viewcode-back" href="../test_build/application.html#application.SearchHandler.generate_field_combo">[docs]</a>  <span class="k">def</span> <span class="nf">generate_field_combo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Artist&#39;</span><span class="p">,</span> <span class="s1">&#39;Genre&#39;</span><span class="p">,</span> <span class="s1">&#39;Label&#39;</span><span class="p">,</span> <span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="s1">&#39;Venue&#39;</span><span class="p">,</span> <span class="s1">&#39;Date&#39;</span><span class="p">]</span>
    <span class="n">comboBox</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">()</span>
    <span class="n">comboBox</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
    <span class="n">comboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_auto_complete</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">comboBox</span></div>

<div class="viewcode-block" id="SearchHandler.update_auto_complete"><a class="viewcode-back" href="../test_build/application.html#application.SearchHandler.update_auto_complete">[docs]</a>  <span class="k">def</span> <span class="nf">update_auto_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates auto-complete instances for advanced search conditions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">3</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">setCompleter</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
      <span class="n">widgetText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
      <span class="n">textEditWidget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>

      <span class="k">if</span> <span class="n">widgetText</span> <span class="o">==</span> <span class="s1">&#39;Artist&#39;</span><span class="p">:</span>
        <span class="n">textEditWidget</span><span class="o">.</span><span class="n">setCompleter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">auto_comp</span><span class="p">(</span><span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;artistList&#39;</span><span class="p">)))</span>
      <span class="k">elif</span> <span class="n">widgetText</span> <span class="o">==</span> <span class="s1">&#39;Location&#39;</span><span class="p">:</span>
        <span class="n">textEditWidget</span><span class="o">.</span><span class="n">setCompleter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">auto_comp</span><span class="p">(</span><span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;newReversedGroupedLocations&#39;</span><span class="p">)))</span>
      <span class="k">elif</span> <span class="n">widgetText</span> <span class="o">==</span> <span class="s1">&#39;Genre&#39;</span><span class="p">:</span>
        <span class="n">textEditWidget</span><span class="o">.</span><span class="n">setCompleter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">auto_comp</span><span class="p">(</span><span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;genreList&#39;</span><span class="p">)))</span></div>

<div class="viewcode-block" id="SearchHandler.generate_condition_combo"><a class="viewcode-back" href="../test_build/application.html#application.SearchHandler.generate_condition_combo">[docs]</a>  <span class="k">def</span> <span class="nf">generate_condition_combo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;is not&#39;</span><span class="p">,</span> <span class="s1">&#39;starts with&#39;</span><span class="p">,</span> <span class="s1">&#39;ends with&#39;</span><span class="p">,</span> <span class="s1">&#39;contains&#39;</span><span class="p">,</span> <span class="s1">&#39;does not contain&#39;</span><span class="p">,</span> <span class="s1">&#39;matches RegEx&#39;</span><span class="p">,</span> <span class="s1">&#39;does not match RegEx&#39;</span><span class="p">]</span>
    <span class="n">comboBox</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">()</span>
    <span class="n">comboBox</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">comboBox</span></div>

<div class="viewcode-block" id="SearchHandler.generate_advanced_search"><a class="viewcode-back" href="../test_build/application.html#application.SearchHandler.generate_advanced_search">[docs]</a>  <span class="k">def</span> <span class="nf">generate_advanced_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">condition</span><span class="p">):</span>
    <span class="n">field_to_sparql</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Artist&#39;</span> <span class="p">:</span> <span class="s1">&#39;?name&#39;</span><span class="p">,</span> <span class="s1">&#39;Label&#39;</span> <span class="p">:</span> <span class="s1">&#39;?prefLabel&#39;</span><span class="p">,</span> <span class="s1">&#39;Location&#39;</span> <span class="p">:</span> <span class="s1">&#39;?place&#39;</span><span class="p">,</span> <span class="s1">&#39;Venue&#39;</span> <span class="p">:</span> <span class="s1">&#39;?venue&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Date&#39;</span> <span class="p">:</span> <span class="s1">&#39;?date&#39;</span><span class="p">,</span> <span class="s1">&#39;Genre&#39;</span> <span class="p">:</span> <span class="s1">&#39;?genre&#39;</span><span class="p">}</span>

    <span class="n">filterString</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;is&#39;</span><span class="p">:</span>
      <span class="n">filterString</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;FILTER(</span><span class="si">{0}</span><span class="s2">=&quot;</span><span class="si">{1}</span><span class="s2">&quot;) &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_to_sparql</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="n">condition</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;is not&#39;</span><span class="p">:</span>
      <span class="n">filterString</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;FILTER(</span><span class="si">{0}</span><span class="s2">!=&quot;</span><span class="si">{1}</span><span class="s2">&quot;) &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_to_sparql</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="n">condition</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;starts with&#39;</span><span class="p">:</span>
      <span class="n">filterString</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;FILTER(STRSTARTS(</span><span class="si">{0}</span><span class="s2">,&quot;</span><span class="si">{1}</span><span class="s2">&quot;)) &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_to_sparql</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="n">condition</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;ends with&#39;</span><span class="p">:</span>
      <span class="n">filterString</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;FILTER(STRENDS(</span><span class="si">{0}</span><span class="s2">,&quot;</span><span class="si">{1}</span><span class="s2">&quot;)) &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_to_sparql</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="n">condition</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;contains&#39;</span><span class="p">:</span>
      <span class="n">filterString</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;FILTER(CONTAINS(</span><span class="si">{0}</span><span class="s2">,&quot;</span><span class="si">{1}</span><span class="s2">&quot;)) &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_to_sparql</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="n">condition</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;does not contain&#39;</span><span class="p">:</span>
      <span class="n">filterString</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;FILTER(!CONTAINS(</span><span class="si">{0}</span><span class="s2">,&quot;</span><span class="si">{1}</span><span class="s2">&quot;) &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_to_sparql</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="n">condition</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;matches RegEx&#39;</span><span class="p">:</span>
      <span class="n">filterString</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;FILTER(regex(</span><span class="si">{0}</span><span class="s2">, &quot;</span><span class="si">{1}</span><span class="s2">&quot;, &quot;i&quot;)) &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_to_sparql</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="n">condition</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;does not match RegEx&#39;</span><span class="p">:</span>
      <span class="n">filterString</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;FILTER(!regex(</span><span class="si">{0}</span><span class="s2">, &quot;</span><span class="si">{1}</span><span class="s2">&quot;, &quot;i&quot;)) &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_to_sparql</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="n">condition</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span><span class="p">(</span><span class="s1">&#39;No matching operator&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">filterString</span></div>

<div class="viewcode-block" id="SearchHandler.custom_search"><a class="viewcode-back" href="../test_build/application.html#application.SearchHandler.custom_search">[docs]</a>  <span class="k">def</span> <span class="nf">custom_search</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates search filter queries for advanced queries from the interface.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get type for these conditions</span>
    <span class="n">customConditions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">3</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">customConditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_advanced_search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">currentText</span><span class="p">(),</span>
                                                              <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">currentText</span><span class="p">(),</span>
                                                              <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>

    <span class="k">if</span> <span class="s1">&#39;OR&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">matchingPolicyCombo</span><span class="o">.</span><span class="n">currentText</span><span class="p">():</span>
      <span class="n">customConditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_condition_or</span><span class="p">(</span><span class="n">customConditions</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">customConditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensure_matching_parentheses</span><span class="p">(</span><span class="n">customConditions</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">customConditions</span></div>

<div class="viewcode-block" id="SearchHandler.change_condition_or"><a class="viewcode-back" href="../test_build/application.html#application.SearchHandler.change_condition_or">[docs]</a>  <span class="k">def</span> <span class="nf">change_condition_or</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customConditions</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjusts a search FILTER from &quot;ALL&quot; or &quot;OR&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    customConditions : str[]</span>
<span class="sd">        A list of custom conditions returned by the class instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">customConditions</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">newStr</span> <span class="o">=</span> <span class="n">item</span><span class="p">[:</span><span class="n">item</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)]</span>
        <span class="n">newStr</span> <span class="o">+=</span> <span class="s2">&quot; ||&quot;</span>
        <span class="n">customConditions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">newStr</span>
      <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">newStr</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;FILTER(&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">newStr</span> <span class="o">=</span> <span class="n">newStr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">newStr</span> <span class="o">+=</span> <span class="s2">&quot; ||&quot;</span>
        <span class="n">customConditions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">newStr</span>
      <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">customConditions</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">newStr</span> <span class="o">=</span> <span class="n">customConditions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">customConditions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">newStr</span>

    <span class="k">return</span> <span class="n">customConditions</span></div>

<div class="viewcode-block" id="SearchHandler.ensure_matching_parentheses"><a class="viewcode-back" href="../test_build/application.html#application.SearchHandler.ensure_matching_parentheses">[docs]</a>  <span class="k">def</span> <span class="nf">ensure_matching_parentheses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customConditions</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs validation on SPARQL filter queries to ensure that our query is valid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    customConditions : str[]</span>
<span class="sd">        A list of custom conditions returned by the class instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">customConditions</span><span class="p">):</span>
      <span class="n">left</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
      <span class="n">right</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>

      <span class="k">while</span> <span class="n">right</span> <span class="o">&lt;</span> <span class="n">left</span><span class="p">:</span>
        <span class="n">item</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

      <span class="n">customConditions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>

    <span class="k">return</span> <span class="n">customConditions</span></div>

<div class="viewcode-block" id="SearchHandler.generate_mapped_locations"><a class="viewcode-back" href="../test_build/application.html#application.SearchHandler.generate_mapped_locations">[docs]</a>  <span class="k">def</span> <span class="nf">generate_mapped_locations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A user may request all performances within a specified radius of a given location.</span>

<span class="sd">    We calculate the desired locations using point-to-point distance calculations, relative</span>
<span class="sd">    to the location map keys.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    countries : str[]</span>
<span class="sd">        A list of performance countries.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># If user requested a range</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">locationRangeFilter</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">locationFilter</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">locations</span> <span class="o">=</span> <span class="p">[]</span>

      <span class="c1"># If p-to-p distance is within our range</span>
      <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">browseListHandler</span><span class="o">.</span><span class="n">locationList</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">locationFilter</span><span class="o">.</span><span class="n">text</span><span class="p">()][</span><span class="s1">&#39;latlng&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
      <span class="n">centerLat</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
      <span class="n">centerLon</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
      <span class="n">radius</span> <span class="o">=</span> <span class="mf">6373.0</span>
      <span class="nb">filter</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

      <span class="c1"># Find all locations within the range specified by the user</span>
      <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">browseListHandler</span><span class="o">.</span><span class="n">locationList</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">keyLat</span><span class="p">,</span> <span class="n">keyLon</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;latlng&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

        <span class="c1"># Convert to floats from strings, then convert to radians</span>
        <span class="n">keyLat</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">keyLat</span><span class="p">))</span>
        <span class="n">keyLon</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">keyLon</span><span class="p">))</span>

        <span class="c1"># Calculate delta between pairs of lat / lngs</span>
        <span class="n">deltaLon</span> <span class="o">=</span> <span class="n">keyLat</span> <span class="o">-</span> <span class="n">centerLon</span>
        <span class="n">deltaLat</span> <span class="o">=</span> <span class="n">keyLon</span> <span class="o">-</span> <span class="n">centerLat</span>

        <span class="c1"># Perform point-to-point distance calculation</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">deltaLat</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">centerLat</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">centerLon</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">deltaLon</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">atan2</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">c</span>

        <span class="c1"># If location is within our distance radius</span>
        <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">locationRangeFilter</span><span class="o">.</span><span class="n">text</span><span class="p">()):</span>
          <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; by a distance of &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">locationRangeFilter</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">-</span> <span class="n">distance</span><span class="p">))</span>

          <span class="c1"># Append all mapped locations for this key to our requested locations</span>
          <span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;locations&#39;</span><span class="p">]:</span>
            <span class="n">locations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">locations</span>
    <span class="c1"># If only 1 location requested</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">locationFilter</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="c1"># Return all mapped locations</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">browseListHandler</span><span class="o">.</span><span class="n">locationList</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">locationFilter</span><span class="o">.</span><span class="n">text</span><span class="p">()][</span><span class="s1">&#39;locations&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="SearchHandler.get_mapped_countries"><a class="viewcode-back" href="../test_build/application.html#application.SearchHandler.get_mapped_countries">[docs]</a>  <span class="k">def</span> <span class="nf">get_mapped_countries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">countries</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves locations in a requested country.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    countries : str[]</span>
<span class="sd">        A list of performance countries.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">countries</span> <span class="o">=</span> <span class="n">countries</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">correspondingLocations</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">country</span> <span class="ow">in</span> <span class="n">countries</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">browseListHandler</span><span class="o">.</span><span class="n">locationList</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">country</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
          <span class="n">correspondingLocations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">browseListHandler</span><span class="o">.</span><span class="n">locationList</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;locations&#39;</span><span class="p">])</span>

    <span class="c1"># Turn into a flat list of locations</span>
    <span class="n">correspondingLocations</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">correspondingLocations</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">correspondingLocations</span></div>


<div class="viewcode-block" id="SearchHandler.perform_search"><a class="viewcode-back" href="../test_build/application.html#application.SearchHandler.perform_search">[docs]</a>  <span class="k">def</span> <span class="nf">perform_search</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Get contents of text boxes</span>
    <span class="n">locations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_mapped_locations</span><span class="p">()</span>
    <span class="n">artists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">artistFilter</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
    <span class="n">genres</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">genreFilter</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">orderBy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">orderByFilter</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
    <span class="n">limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">numResultsSpinbox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
    <span class="n">venue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">venueFilter</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
    <span class="n">trackName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">trackNameFilter</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">countryFilter</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">countries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mapped_countries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">countryFilter</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">countries</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># Custom search conditions</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">advancedSearchLayout</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">customSearchString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_search</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">customSearchString</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="c1"># Generate SPARQL query</span>
    <span class="n">query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">perform_search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">dateFrom</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">dateTo</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="n">artists</span><span class="p">,</span> <span class="n">genres</span><span class="p">,</span> <span class="n">locations</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">trackName</span><span class="p">,</span>
                                            <span class="n">countries</span><span class="p">,</span> <span class="n">customSearchString</span><span class="p">,</span> <span class="n">venue</span><span class="p">,</span> <span class="n">orderBy</span><span class="p">)</span>

    <span class="c1"># Execute SPARQL query</span>
    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">execute_string</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

    <span class="c1"># Collect requested views</span>
    <span class="n">requestedViews</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">mapViewChk</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="p">:</span> <span class="n">requestedViews</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">timelineViewChk</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="p">:</span> <span class="n">requestedViews</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;timeline&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">tableViewChk</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="p">:</span> <span class="n">requestedViews</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;calma&#39;</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;head&#39;</span><span class="p">][</span><span class="s1">&#39;vars&#39;</span><span class="p">]:</span>
      <span class="n">hasCalma</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">hasCalma</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Create views</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">requestedViews</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">hasCalma</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">searchTabWidget</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">goResultsTab</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTabWidget</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">searchTabWidget</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goResultsTab</span><span class="p">,</span> <span class="s2">&quot;Results --&gt;&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">searchTabWidget</span><span class="o">.</span><span class="n">currentChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">change_to_results</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">searchTabWidget</span><span class="o">.</span><span class="n">tabBar</span><span class="p">()</span><span class="o">.</span><span class="n">setTabTextColor</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>

    <span class="c1"># self.main.searchTabWidget.hide()</span>
    <span class="n">removed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">searchTab</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">takeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">searchTab</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">get_layout</span><span class="p">())</span></div></div>

<div class="viewcode-block" id="BrowseTreeViewHandler"><a class="viewcode-back" href="../test_build/application.html#application.BrowseTreeViewHandler">[docs]</a><span class="k">class</span> <span class="nc">BrowseTreeViewHandler</span><span class="p">():</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span> <span class="o">=</span> <span class="n">main</span>

<div class="viewcode-block" id="BrowseTreeViewHandler.tree_view_filter_update"><a class="viewcode-back" href="../test_build/application.html#application.BrowseTreeViewHandler.tree_view_filter_update">[docs]</a>  <span class="k">def</span> <span class="nf">tree_view_filter_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides filter functionality for the the tree view.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">searchStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">treeViewFilter</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
      <span class="n">itemsFound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">findItems</span><span class="p">(</span><span class="n">searchStr</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">MatchContains</span><span class="p">)</span>

      <span class="c1"># If items found</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">itemsFound</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itemsFound</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">searchStr</span><span class="p">:</span>
            <span class="c1"># Remove row from it&#39;s current position</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">takeRow</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">row</span><span class="p">())</span>

            <span class="c1"># Move the row to the top of the list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">insertRow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="c1"># If no model set, return</span>
      <span class="k">return</span></div>

<div class="viewcode-block" id="BrowseTreeViewHandler.expand_tree_item"><a class="viewcode-back" href="../test_build/application.html#application.BrowseTreeViewHandler.expand_tree_item">[docs]</a>  <span class="k">def</span> <span class="nf">expand_tree_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Expands a performance, adding its tracklist as children in the tree.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    index : QModelIndex</span>
<span class="sd">        The index in the treeview (i.e. the performance), clicked.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">treeViewModel</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
      <span class="c1"># Get name of selected item</span>
      <span class="n">tracklist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">get_tracklist</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">()))</span>
      <span class="n">preferredFormats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FLAC&#39;</span><span class="p">,</span> <span class="s1">&#39;VBR.MP3&#39;</span><span class="p">,</span> <span class="s1">&#39;SHN&#39;</span><span class="p">,</span> <span class="s1">&#39;OGG&#39;</span><span class="p">,</span> <span class="s1">&#39;WAV&#39;</span><span class="p">,</span> <span class="s1">&#39;64.MP3&#39;</span><span class="p">]</span>
      <span class="n">foundFormat</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="n">formatIndex</span> <span class="o">=</span> <span class="mi">0</span>

      <span class="k">while</span> <span class="n">foundFormat</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">formatIndex</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">preferredFormats</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_tracks_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">formats</span><span class="p">[</span><span class="n">formatIndex</span><span class="p">],</span> <span class="n">tracklist</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
          <span class="n">foundFormat</span> <span class="o">=</span> <span class="kc">True</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">debugDialog</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">: found matching format </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">formats</span><span class="p">[</span><span class="n">formatIndex</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">formatIndex</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="n">foundFormat</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">debugDialog</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">: failed to find matching format&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Did not find matching format&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">tracklist</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;audio&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">treeViewModel</span><span class="p">)</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">browseTreeProperties</span><span class="o">.</span><span class="n">retrieve_release_info</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">())</span></div>

<div class="viewcode-block" id="BrowseTreeViewHandler.add_tracks_tree"><a class="viewcode-back" href="../test_build/application.html#application.BrowseTreeViewHandler.add_tracks_tree">[docs]</a>  <span class="k">def</span> <span class="nf">add_tracks_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extension_type</span><span class="p">,</span> <span class="n">tracklist</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a tracklist to the tree view.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    extension_type : str</span>
<span class="sd">        The requested format for the audio association.</span>
<span class="sd">    tracklist : dict</span>
<span class="sd">        The tracklist for the performance.</span>
<span class="sd">    index : QModelIndex</span>
<span class="sd">        The index in the treeview (i.e. the performance), clicked.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># For each item in tracklist</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">tracklist</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">]:</span>

      <span class="c1"># If desired extension matches a track</span>
      <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;audio&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">extension_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>

        <span class="c1"># Add to treeView</span>
        <span class="n">listItem</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;. &#39;</span> <span class="o">+</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">treeViewModel</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">setChild</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">listItem</span><span class="p">)</span>

        <span class="c1"># Store audio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">childrenFetched</span><span class="p">[</span><span class="n">listItem</span><span class="o">.</span><span class="n">text</span><span class="p">()]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;audio&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># If no tracks were added (i.e. the format provided failed)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="BrowseTreeViewHandler.play_tree_item"><a class="viewcode-back" href="../test_build/application.html#application.BrowseTreeViewHandler.play_tree_item">[docs]</a>  <span class="k">def</span> <span class="nf">play_tree_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Called when an item in the browse tab treeview is double-clicked, starting audio playback</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    index : QModelIndex</span>
<span class="sd">        The row index clicked by the user.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># If this is a release, and not a singular track</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">treeViewModel</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
      <span class="c1"># Play every track in this recording</span>
      <span class="n">tracklist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">get_tracklist</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">())</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">debugDialog</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">: retrieved tracklist for release </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">,</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">()))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">user_audio_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">extract_tracklist_single_format</span><span class="p">(</span><span class="n">tracklist</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># If user clicked on a track</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">tracklist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">get_tracklist</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">())</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">debugDialog</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">: retrieved tracklist for release </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">,</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">()))</span>
      <span class="n">audio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">childrenFetched</span><span class="p">[</span><span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">()]</span>

      <span class="c1"># Get correct extension</span>
      <span class="n">audioList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">extract_tracklist_single_format</span><span class="p">(</span><span class="n">tracklist</span><span class="p">)</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="n">trackIndex</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

      <span class="n">foundIndex</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="n">v</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
      <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">audioList</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">foundIndex</span><span class="p">:</span>
          <span class="n">v</span> <span class="o">+=</span> <span class="mi">1</span>
          <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;audio&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">audio</span><span class="p">:</span>
            <span class="n">trackIndex</span> <span class="o">=</span> <span class="n">v</span>
            <span class="n">foundIndex</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Start process of playing audio</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">user_audio_clicked</span><span class="p">(</span><span class="n">audioList</span><span class="p">,</span> <span class="n">trackIndex</span><span class="p">)</span>

    <span class="c1"># Update icons</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">isPlaying</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">playPauseBtn</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">qta</span><span class="o">.</span><span class="n">icon</span><span class="p">(</span><span class="s1">&#39;fa.pause&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="BrowseTreeViewHandler.update_tree_view"><a class="viewcode-back" href="../test_build/application.html#application.BrowseTreeViewHandler.update_tree_view">[docs]</a>  <span class="k">def</span> <span class="nf">update_tree_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemText</span><span class="p">):</span>
    <span class="n">selectedType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">typeBrowseCombo</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
    <span class="c1"># We do not need any extra triples to get artist information, so final 2 arguments are NULL</span>
    <span class="k">if</span> <span class="n">selectedType</span> <span class="o">==</span> <span class="s1">&#39;Artist&#39;</span><span class="p">:</span>
      <span class="n">modelRawData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">get_artist_releases</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">itemText</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">selectedType</span> <span class="o">==</span> <span class="s1">&#39;Genre&#39;</span><span class="p">:</span>
      <span class="n">modelRawData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">get_artist_releases</span><span class="p">(</span><span class="s1">&#39;genre&#39;</span><span class="p">,</span> <span class="n">itemText</span><span class="p">,</span> <span class="s1">&#39;?genre&#39;</span><span class="p">,</span> <span class="s1">&#39;?performer etree:mbTag ?genre.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">selectedType</span> <span class="o">==</span> <span class="s1">&#39;Location&#39;</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">itemText</span><span class="p">)</span>
      <span class="n">modelRawData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">get_artist_releases</span><span class="p">(</span><span class="s1">&#39;place&#39;</span><span class="p">,</span> <span class="n">itemText</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">treeViewModel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">browseTreeView</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">modelRawData</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;bindings&quot;</span><span class="p">]:</span>
      <span class="c1"># Create an item to add to the model</span>
      <span class="n">item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;prefLabel&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>

      <span class="c1"># Add item to our model</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">treeViewModel</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="c1"># Set our model to the browsing list</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">browseTreeView</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">treeViewModel</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="TableHandler"><a class="viewcode-back" href="../test_build/application.html#application.TableHandler">[docs]</a><span class="k">class</span> <span class="nc">TableHandler</span><span class="p">():</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prog</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prog</span> <span class="o">=</span> <span class="n">prog</span>

    <span class="c1"># Create table thread</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sublist</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Create a new tab in our table widget</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">)</span>

<div class="viewcode-block" id="TableHandler.on_table_scroll"><a class="viewcode-back" href="../test_build/application.html#application.TableHandler.on_table_scroll">[docs]</a>  <span class="k">def</span> <span class="nf">on_table_scroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starts a new thread for replacing URIs with location labels.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    value : int</span>
<span class="sd">        The desired row index.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">viewport</span><span class="p">()</span><span class="o">.</span><span class="n">rect</span><span class="p">()</span>
    <span class="n">topRow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">indexAt</span><span class="p">(</span><span class="n">rect</span><span class="o">.</span><span class="n">topLeft</span><span class="p">())</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>

    <span class="c1"># Retrieve labels for next 5 items</span>
    <span class="n">worker</span> <span class="o">=</span> <span class="n">multithreading</span><span class="o">.</span><span class="n">WorkerThread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retrieve_labels_scroll</span><span class="p">,</span> <span class="n">topRow</span><span class="p">)</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">qt_signals</span><span class="o">.</span><span class="n">update_table_item</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_table_item</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">threadpool</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">worker</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableHandler.retrieve_labels_scroll"><a class="viewcode-back" href="../test_build/application.html#application.TableHandler.retrieve_labels_scroll">[docs]</a>  <span class="k">def</span> <span class="nf">retrieve_labels_scroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startRow</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves location labels to replace URIs, upon scrolling.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    value : int</span>
<span class="sd">        The desired row index.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">rowIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">startRow</span><span class="p">,</span> <span class="n">startRow</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">height</span><span class="p">()</span><span class="o">/</span><span class="mf">25.5</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">columnIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
          <span class="k">if</span> <span class="s1">&#39;http://etree.&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">rowIndex</span><span class="p">,</span> <span class="n">columnIndex</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">():</span>
            <span class="n">newLabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_label_for_URI</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">rowIndex</span><span class="p">,</span> <span class="n">columnIndex</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;update_table_item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">rowIndex</span><span class="p">,</span> <span class="n">columnIndex</span><span class="p">,</span> <span class="n">newLabel</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">a</span><span class="p">:</span>
      <span class="k">return</span></div>

<div class="viewcode-block" id="TableHandler.update_table_item"><a class="viewcode-back" href="../test_build/application.html#application.TableHandler.update_table_item">[docs]</a>  <span class="k">def</span> <span class="nf">update_table_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates a particular table item.</span>

<span class="sd">    This function is mainly used for replacing URIs with human-readable labels.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    row : int</span>
<span class="sd">        The desired row index.</span>
<span class="sd">    col : int</span>
<span class="sd">        The desired column index.</span>
<span class="sd">    text : str</span>
<span class="sd">        The text to update the item with.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableHandler.get_table_container"><a class="viewcode-back" href="../test_build/application.html#application.TableHandler.get_table_container">[docs]</a>  <span class="k">def</span> <span class="nf">get_table_container</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the table element instance widget.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget</span></div>

<div class="viewcode-block" id="TableHandler.get_table"><a class="viewcode-back" href="../test_build/application.html#application.TableHandler.get_table">[docs]</a>  <span class="k">def</span> <span class="nf">get_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the table element instance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span></div>

<div class="viewcode-block" id="TableHandler.fill_table"><a class="viewcode-back" href="../test_build/application.html#application.TableHandler.fill_table">[docs]</a>  <span class="k">def</span> <span class="nf">fill_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starts a thread to fill the table with the data returned from a search.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    results : dict</span>
<span class="sd">        Dictionary of results returned from the SPARQL query.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">worker</span> <span class="o">=</span> <span class="n">multithreading</span><span class="o">.</span><span class="n">WorkerThread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_results_table</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">qt_signals</span><span class="o">.</span><span class="n">add_table_item</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_table_item</span><span class="p">)</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">qt_signals</span><span class="o">.</span><span class="n">start_table</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_table_start</span><span class="p">)</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">qt_signals</span><span class="o">.</span><span class="n">end_table</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_table_end</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">threadpool</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">worker</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">debugDialog</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">: started table thread&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="TableHandler.add_table_item"><a class="viewcode-back" href="../test_build/application.html#application.TableHandler.add_table_item">[docs]</a>  <span class="k">def</span> <span class="nf">add_table_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">itemText</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds an item to the table view.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    i : int</span>
<span class="sd">        Row index.</span>
<span class="sd">    c : int</span>
<span class="sd">        Row index.</span>
<span class="sd">    itemText : str</span>
<span class="sd">        Table item text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">itemText</span><span class="p">)</span>
      <span class="c1">#self.prog.debugDialog.add_line(&quot;{0}: added table item at index ({1},{2}) with text {3}&quot;.format(sys._getframe().f_code.co_name, i, c,</span>
      <span class="c1">#                                                                                               artist.data()))</span>
    <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;addTableItem exception: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>

<div class="viewcode-block" id="TableHandler.generate_table_start"><a class="viewcode-back" href="../test_build/application.html#application.TableHandler.generate_table_start">[docs]</a>  <span class="k">def</span> <span class="nf">generate_table_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">columnNames</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds an item to the table view.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    c : int</span>
<span class="sd">        Number of rows for the table.</span>
<span class="sd">    col : int</span>
<span class="sd">        Number of columns for the table.</span>
<span class="sd">    columnNames : str[]</span>
<span class="sd">        List of column names.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Hide the widget while we process data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

    <span class="c1"># Set table size and initial properties</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">(</span><span class="n">columnNames</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">setSortingEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Set header properties</span>
    <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span>
    <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">Interactive</span><span class="p">)</span>
    <span class="n">header</span><span class="o">.</span><span class="n">setStretchLastSection</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">vHeader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">verticalHeader</span><span class="p">()</span>
    <span class="n">vHeader</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">debugDialog</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">: set initial table properties&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="TableHandler.generate_table_end"><a class="viewcode-back" href="../test_build/application.html#application.TableHandler.generate_table_end">[docs]</a>  <span class="k">def</span> <span class="nf">generate_table_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform post-processing on table after all the data has been entered.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    self : instance</span>
<span class="sd">        Class instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set final properties for the table</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">setSortingEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">setSelectionBehavior</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">SelectRows</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">setSizeAdjustPolicy</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractScrollArea</span><span class="o">.</span><span class="n">AdjustToContentsOnFirstShow</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">itemDoubleClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_table_clicked</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>

    <span class="c1"># Add focus signal handlers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">itemClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">searchHandler</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">move_focus</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">verticalScrollBar</span><span class="p">()</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_table_scroll</span><span class="p">)</span>

    <span class="c1"># Get first 5 URI replacements</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">on_table_scroll</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Add widget to the data view</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">set_location_width</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">debugDialog</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">: set final table properties&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableHandler.search_table_clicked"><a class="viewcode-back" href="../test_build/application.html#application.TableHandler.search_table_clicked">[docs]</a>  <span class="k">def</span> <span class="nf">search_table_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">searchColumn</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># If another column clicked</span>
    <span class="k">if</span> <span class="n">title</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">tableWidget</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">title</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">tracklist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">get_tracklist</span><span class="p">(</span><span class="n">title</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">user_audio_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">extract_tracklist_single_format</span><span class="p">(</span><span class="n">tracklist</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableHandler.change_focus"><a class="viewcode-back" href="../test_build/application.html#application.TableHandler.change_focus">[docs]</a>  <span class="k">def</span> <span class="nf">change_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="n">searchColumn</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
      <span class="c1"># Add line to debug dialog</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">debugDialog</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">: moving focus to index </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>

      <span class="c1"># If index is a number</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_is_number</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
        <span class="c1"># Select that row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Find label column in table</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
          <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Label&#39;</span><span class="p">:</span>
            <span class="n">searchColumn</span> <span class="o">=</span> <span class="n">c</span>

        <span class="k">if</span> <span class="n">searchColumn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
          <span class="c1"># Find matching label</span>
          <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">searchColumn</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="o">==</span> <span class="n">index</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
              <span class="k">return</span> <span class="n">row</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TableHandler.check_is_number"><a class="viewcode-back" href="../test_build/application.html#application.TableHandler.check_is_number">[docs]</a>  <span class="k">def</span> <span class="nf">check_is_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="c1"># Try and convert to a float</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">True</span>
    <span class="c1"># If not a number</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
      <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TableHandler.generate_results_table"><a class="viewcode-back" href="../test_build/application.html#application.TableHandler.generate_results_table">[docs]</a>  <span class="k">def</span> <span class="nf">generate_results_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">titleList</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Calculate the properties we should apply to our table</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;bindings&quot;</span><span class="p">]:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">titleList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
          <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
          <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span>
          <span class="n">col</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>

        <span class="c1"># Tidy up column names</span>
        <span class="n">columnNames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span>
            <span class="n">columnNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Performance Title&quot;</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="n">columnNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>

        <span class="c1"># Dynamically set table properties</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_table_callback&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">columnNames</span><span class="p">)</span>

        <span class="c1"># Add data to the table</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;bindings&quot;</span><span class="p">]:</span>
          <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
          <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="c1"># Create new table item and emit details of this to main thread</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="ow">and</span> <span class="s1">&#39;http://etree&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">column</span><span class="p">)][</span><span class="s2">&quot;value&quot;</span><span class="p">]:</span>
              <span class="n">artist</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_label_for_URI</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">column</span><span class="p">)][</span><span class="s2">&quot;value&quot;</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;calma&#39;</span><span class="p">:</span>
              <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">column</span><span class="p">)][</span><span class="s2">&quot;value&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">artist</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
              <span class="k">else</span><span class="p">:</span>
                <span class="n">artist</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
              <span class="n">artist</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">column</span><span class="p">)][</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;add_table_item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">artist</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span>
          <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="c1"># Resize to contents after adding data</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fin_table_callback&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableHandler.get_label_for_URI"><a class="viewcode-back" href="../test_build/application.html#application.TableHandler.get_label_for_URI">[docs]</a>  <span class="k">def</span> <span class="nf">get_label_for_URI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">URI</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">get_release_subproperties</span><span class="p">(</span><span class="n">URI</span><span class="p">)</span>
    <span class="k">for</span> <span class="nb">property</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">]:</span>
      <span class="k">if</span> <span class="nb">property</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;http://www.w3.org/2004/02/skos/core#prefLabel&quot;</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="nb">property</span><span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">label</span> <span class="o">=</span> <span class="n">URI</span>

    <span class="k">return</span> <span class="n">label</span></div>

<div class="viewcode-block" id="TableHandler.set_location_width"><a class="viewcode-back" href="../test_build/application.html#application.TableHandler.set_location_width">[docs]</a>  <span class="k">def</span> <span class="nf">set_location_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Location&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsTable</span><span class="o">.</span><span class="n">setColumnWidth</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hit&#39;</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="MapHandler"><a class="viewcode-back" href="../test_build/application.html#application.MapHandler">[docs]</a><span class="k">class</span> <span class="nc">MapHandler</span><span class="p">():</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prog</span><span class="p">,</span> <span class="n">webEngine</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="n">webEngine</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prog</span> <span class="o">=</span> <span class="n">prog</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mapsClass</span> <span class="o">=</span> <span class="n">maps</span><span class="o">.</span><span class="n">Maps</span><span class="p">()</span>

<div class="viewcode-block" id="MapHandler.get_on_this_day"><a class="viewcode-back" href="../test_build/application.html#application.MapHandler.get_on_this_day">[docs]</a>  <span class="k">def</span> <span class="nf">get_on_this_day</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">homePageSPARQL</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;PREFIX etree:&lt;http://etree.linkedmusic.org/vocab/&gt;</span>
<span class="s2">                        PREFIX mo:&lt;http://purl.org/ontology/mo/&gt;</span>
<span class="s2">                        PREFIX event:&lt;http://purl.org/NET/c4dm/event.owl#&gt;</span>
<span class="s2">                        PREFIX skos:&lt;http://www.w3.org/2004/02/skos/core#&gt;</span>
<span class="s2">                        PREFIX timeline:&lt;http://purl.org/NET/c4dm/timeline.owl#&gt;</span>
<span class="s2">                        PREFIX rdf:&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>

<span class="s2">                        SELECT DISTINCT ?performer ?name ?label  ?place  ?date  WHERE </span>
<span class="s2">                        {    </span>
<span class="s2">                              ?art skos:prefLabel ?label.  </span>
<span class="s2">                              ?art event:place ?location. </span>
<span class="s2">                              ?location etree:location ?place.</span>
<span class="s2">                              ?performer foaf:name ?name. </span>
<span class="s2">                              ?art etree:date ?date.</span>
<span class="s2">                              ?art mo:performer ?performer.</span>
<span class="s2">                              FILTER (regex(?date,&#39;&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;&#39;,</span>
<span class="s2">                              &#39;i&#39;))</span>
<span class="s2">                        }  GROUP BY (?prefLabel) LIMIT 100&quot;&quot;&quot;</span>

    <span class="n">homepageResults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">execute_string</span><span class="p">(</span><span class="n">homePageSPARQL</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">homepageResults</span></div>
    <span class="c1"># if isinstance(homepageResults, Exception):</span>
    <span class="c1">#   self.serverErrorDialog = ErrorDialog(str(homepageResults))</span>
    <span class="c1"># else:</span>
    <span class="c1">#   worker = multithreading.WorkerThread(self.mapsClass.homepage_add, homepageResults)</span>
    <span class="c1">#   worker.qt_signals.js_callback.connect(self.add_point)</span>
    <span class="c1">#   worker.qt_signals.homepage_end.connect(self.end_data_processing)</span>
    <span class="c1">#   worker.qt_signals.homepage_start.connect(self.start_data_processing)</span>
    <span class="c1">#   self.prog.threadpool.start(worker)</span>

<div class="viewcode-block" id="MapHandler.add_search_results_map"><a class="viewcode-back" href="../test_build/application.html#application.MapHandler.add_search_results_map">[docs]</a>  <span class="k">def</span> <span class="nf">add_search_results_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">worker</span> <span class="o">=</span> <span class="n">multithreading</span><span class="o">.</span><span class="n">WorkerThread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapsClass</span><span class="o">.</span><span class="n">homepage_add</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
      <span class="n">worker</span><span class="o">.</span><span class="n">qt_signals</span><span class="o">.</span><span class="n">js_callback</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_point</span><span class="p">)</span>
      <span class="n">worker</span><span class="o">.</span><span class="n">qt_signals</span><span class="o">.</span><span class="n">homepage_end</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_data_processing</span><span class="p">)</span>
      <span class="n">worker</span><span class="o">.</span><span class="n">qt_signals</span><span class="o">.</span><span class="n">homepage_start</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_data_processing</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">threadpool</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">worker</span><span class="p">)</span></div>

<div class="viewcode-block" id="MapHandler.process_search_results"><a class="viewcode-back" href="../test_build/application.html#application.MapHandler.process_search_results">[docs]</a>  <span class="k">def</span> <span class="nf">process_search_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_data_processing</span><span class="p">()</span>
    <span class="c1"># For each item of data</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">]:</span>
      <span class="c1"># Send message to main thread to pass data to JS instance</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">mapsClass</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;js_callback&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">runJavaScript</span><span class="p">(</span><span class="s1">&#39;onFinishQuery(0)&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MapHandler.end_data_processing"><a class="viewcode-back" href="../test_build/application.html#application.MapHandler.end_data_processing">[docs]</a>  <span class="k">def</span> <span class="nf">end_data_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Tell JS instance that no more data will be sent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">runJavaScript</span><span class="p">(</span><span class="s1">&#39;onFinishQuery(0)&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MapHandler.start_data_processing"><a class="viewcode-back" href="../test_build/application.html#application.MapHandler.start_data_processing">[docs]</a>  <span class="k">def</span> <span class="nf">start_data_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Tell JS instance to prepare for data to be processed</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">runJavaScript</span><span class="p">(</span><span class="s1">&#39;newDataSet(0)&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MapHandler.add_point"><a class="viewcode-back" href="../test_build/application.html#application.MapHandler.add_point">[docs]</a>  <span class="k">def</span> <span class="nf">add_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lng</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">js</span> <span class="o">=</span> <span class="s2">&quot;addPoint(&quot;</span> <span class="o">+</span> <span class="n">lat</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="n">lng</span> <span class="o">+</span> <span class="s2">&quot;, 1, 0,`&quot;</span> <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="s2">&quot;`);&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">runJavaScript</span><span class="p">(</span><span class="n">js</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="DebugDialog"><a class="viewcode-back" href="../test_build/application.html#application.DebugDialog">[docs]</a><span class="k">class</span> <span class="nc">DebugDialog</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTextEdit</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setFixedSize</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Debug Window&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="DebugDialog.add_line"><a class="viewcode-back" href="../test_build/application.html#application.DebugDialog.add_line">[docs]</a>  <span class="k">def</span> <span class="nf">add_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

    <span class="c1"># Scroll to bottom</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verticalScrollBar</span><span class="p">()</span><span class="o">.</span><span class="n">maximum</span><span class="p">()</span></div>

<div class="viewcode-block" id="DebugDialog.clear"><a class="viewcode-back" href="../test_build/application.html#application.DebugDialog.clear">[docs]</a>  <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div></div>

<div class="viewcode-block" id="NowPlaying"><a class="viewcode-back" href="../test_build/application.html#application.NowPlaying">[docs]</a><span class="k">class</span> <span class="nc">NowPlaying</span><span class="p">():</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prog</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prog</span> <span class="o">=</span> <span class="n">prog</span>

<div class="viewcode-block" id="NowPlaying.update_now_playing_view"><a class="viewcode-back" href="../test_build/application.html#application.NowPlaying.update_now_playing_view">[docs]</a>  <span class="k">def</span> <span class="nf">update_now_playing_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Update various GUI elements</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update_playlist_view</span><span class="p">()</span></div>

<div class="viewcode-block" id="NowPlaying.get_image"><a class="viewcode-back" href="../test_build/application.html#application.NowPlaying.get_image">[docs]</a>  <span class="k">def</span> <span class="nf">get_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artist</span><span class="p">):</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="NowPlaying.update_playlist_view"><a class="viewcode-back" href="../test_build/application.html#application.NowPlaying.update_playlist_view">[docs]</a>  <span class="k">def</span> <span class="nf">update_playlist_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Clear contents of playlist view</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">playlistViewModel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">playlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">playlist</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">selectionModel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">playlist_view</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">playlist_index</span>

    <span class="n">rowIndex</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">toBeSelected</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">playlist</span><span class="p">:</span>
      <span class="n">qStandardItem</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">playlistViewModel</span><span class="o">.</span><span class="n">insertRow</span><span class="p">(</span><span class="n">rowIndex</span><span class="p">,</span> <span class="n">qStandardItem</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">rowIndex</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">audioHandler</span><span class="o">.</span><span class="n">playlist_index</span><span class="p">:</span>
        <span class="n">toBeSelected</span> <span class="o">=</span> <span class="n">qStandardItem</span>

      <span class="n">rowIndex</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">playlist_view</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">playlistViewModel</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="o">.</span><span class="n">playlist_view</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">playlistViewModel</span><span class="o">.</span><span class="n">indexFromItem</span><span class="p">(</span><span class="n">toBeSelected</span><span class="p">))</span></div></div>

<div class="viewcode-block" id="TimelineHandler"><a class="viewcode-back" href="../test_build/application.html#application.TimelineHandler">[docs]</a><span class="k">class</span> <span class="nc">TimelineHandler</span><span class="p">():</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">webEngine</span><span class="p">,</span> <span class="n">main</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">main</span> <span class="o">=</span> <span class="n">main</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">webEngine</span> <span class="o">=</span> <span class="n">webEngine</span>

<div class="viewcode-block" id="TimelineHandler.add_points"><a class="viewcode-back" href="../test_build/application.html#application.TimelineHandler.add_points">[docs]</a>  <span class="k">def</span> <span class="nf">add_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">]:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">webEngine</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">runJavaScript</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;addPoint(`</span><span class="si">{0}</span><span class="s2">`,`</span><span class="si">{1}</span><span class="s2">`,`</span><span class="si">{2}</span><span class="s2">`)&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]))</span>
      <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">webEngine</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">runJavaScript</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;addTimeline()&quot;&quot;&quot;</span><span class="p">)</span></div></div>

<span class="c1"># Python-side call handler for communicating between audio player / map and python</span>
<div class="viewcode-block" id="CallHandler"><a class="viewcode-back" href="../test_build/application.html#application.CallHandler">[docs]</a><span class="k">class</span> <span class="nc">CallHandler</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">):</span>
<div class="viewcode-block" id="CallHandler.mapLinkClicked"><a class="viewcode-back" href="../test_build/application.html#application.CallHandler.mapLinkClicked">[docs]</a>  <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">mapLinkClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link</span><span class="p">):</span>
    <span class="n">tracklist</span> <span class="o">=</span> <span class="n">sparql</span><span class="o">.</span><span class="n">getTracklist</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
    <span class="n">prog</span><span class="o">.</span><span class="n">user_audio_clicked</span><span class="p">(</span><span class="n">tracklist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="CallHandler.map_tracklist_popup"><a class="viewcode-back" href="../test_build/application.html#application.CallHandler.map_tracklist_popup">[docs]</a>  <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">map_tracklist_popup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span>

    <span class="n">prog</span><span class="o">.</span><span class="n">searchHandler</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">move_focus</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="n">popup</span> <span class="o">=</span> <span class="s2">&quot;&lt;bold&gt;</span><span class="si">{0}</span><span class="s2">&lt;/bold&gt;&lt;br&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

    <span class="c1"># Get venue information for this arg</span>
    <span class="n">geoInfo</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">sparql</span><span class="o">.</span><span class="n">get_venue_information</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">geoInfo</span><span class="p">[</span><span class="s1">&#39;lastfm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">geoInfo</span><span class="p">[</span><span class="s1">&#39;lastfm&#39;</span><span class="p">])</span>
      <span class="n">popup</span> <span class="o">+=</span> <span class="n">geoInfo</span><span class="p">[</span><span class="s1">&#39;lastfm&#39;</span><span class="p">]</span> <span class="c1"># prog.lastfmHandler.get_venue_info(geoInfo[&#39;lastfm&#39;])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">popup</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt; Last.FM data unavailable.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">geoInfo</span><span class="p">[</span><span class="s1">&#39;geoname&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="nb">id</span> <span class="o">=</span> <span class="n">geoInfo</span><span class="p">[</span><span class="s1">&#39;geoname&#39;</span><span class="p">][</span><span class="n">geoInfo</span><span class="p">[</span><span class="s1">&#39;geoname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
      <span class="n">popup</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_geoname_html</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">popup</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;GeoNames data unavailable.&quot;</span><span class="p">)</span>
    <span class="n">prog</span><span class="o">.</span><span class="n">searchHandler</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">mapSearchDialog</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">runJavaScript</span><span class="p">(</span><span class="s2">&quot;setPopup(</span><span class="si">{0}</span><span class="s2">,`</span><span class="si">{1}</span><span class="s2">`)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">popup</span><span class="p">))</span></div>

<div class="viewcode-block" id="CallHandler.generate_geoname_html"><a class="viewcode-back" href="../test_build/application.html#application.CallHandler.generate_geoname_html">[docs]</a>  <span class="k">def</span> <span class="nf">generate_geoname_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://api.geonames.org/getJSON?geonameId=</span><span class="si">{0}</span><span class="s2">&amp;username=</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="s2">&quot;Masutatsu&quot;</span><span class="p">))</span>
    <span class="n">json</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;br&gt;&lt;br&gt; &lt;b&gt;Location:&lt;/b&gt; </span><span class="si">{0}</span><span class="s2"> &lt;br&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
    <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;b&gt;Latitude:&lt;/b&gt; </span><span class="si">{0}</span><span class="s2"> &lt;br&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span>
    <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;b&gt;Longitude:&lt;/b&gt; </span><span class="si">{0}</span><span class="s2"> &lt;br&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;lng&#39;</span><span class="p">])</span>
    <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;b&gt;Timezone:&lt;/b&gt; </span><span class="si">{0}</span><span class="s2"> (GMT </span><span class="si">{1}</span><span class="s2">) &lt;br&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;timezone&#39;</span><span class="p">][</span><span class="s1">&#39;timeZoneId&#39;</span><span class="p">],</span> <span class="n">json</span><span class="p">[</span><span class="s1">&#39;timezone&#39;</span><span class="p">][</span><span class="s1">&#39;gmtOffset&#39;</span><span class="p">])</span>
    <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;a href=geoNamesBounds(</span><span class="si">{0}</span><span class="s2">,</span><span class="si">{1}</span><span class="s2">,</span><span class="si">{2}</span><span class="s2">,</span><span class="si">{3}</span><span class="s2">)&gt;View GeoNames bounds&lt;/a&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;bbox&#39;</span><span class="p">][</span><span class="s1">&#39;east&#39;</span><span class="p">],</span> <span class="n">json</span><span class="p">[</span><span class="s1">&#39;bbox&#39;</span><span class="p">][</span><span class="s1">&#39;south&#39;</span><span class="p">],</span>
                                                                                      <span class="n">json</span><span class="p">[</span><span class="s1">&#39;bbox&#39;</span><span class="p">][</span><span class="s1">&#39;north&#39;</span><span class="p">],</span> <span class="n">json</span><span class="p">[</span><span class="s1">&#39;bbox&#39;</span><span class="p">][</span><span class="s1">&#39;west&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">html</span></div></div>
<div class="viewcode-block" id="ErrorDialog"><a class="viewcode-back" href="../test_build/application.html#application.ErrorDialog">[docs]</a><span class="k">class</span> <span class="nc">ErrorDialog</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QErrorMessage</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;HTTPError&#39;</span><span class="p">:</span>
      <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;A HTTP error occurred, this could be due to the SPARQL end-point being unavailable&#39;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error dialog recieved non-mapped error: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
      <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="ne">Exception</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="c1"># Create QApplication instance</span>
  <span class="n">app</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

  <span class="c1"># Create dialog to show this instance</span>
  <span class="n">dialog</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMainWindow</span><span class="p">()</span>

  <span class="c1"># Start main event loop</span>
  <span class="n">prog</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="p">(</span><span class="n">dialog</span><span class="p">)</span>

  <span class="c1"># Show the main dialog window to user</span>
  <span class="n">dialog</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

  <span class="c1"># On user exit, stop the application</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
 
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Cameron Allan.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>